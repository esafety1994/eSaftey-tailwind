<!-- Product media gallery snippet -->
{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- assign start_index = 0 -%}
{%- if current_variant -%}
  {%- if current_variant.featured_image -%}
    {%- for image in product.images -%}
      {%- if image.src == current_variant.featured_image.src -%}
        {%- assign start_index = forloop.index0 -%}
      {%- endif -%}
    {%- endfor -%}
  {%- elsif current_variant.image -%}
    {%- for image in product.images -%}
      {%- if image.src == current_variant.image.src -%}
        {%- assign start_index = forloop.index0 -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}
{%- endif -%}
<div class="max-w-xl m-auto">
  <div class="glide" id="esProductGlide" data-start-index="{{ start_index }}" data-esProductGlideCount="{{ product.images.size }}">
    <div class="glide__track" data-glide-el="track">
      <ul class="glide__slides">
        {% for image in product.images %}
          <li class="glide__slide">
            <div class="relative group">
              <img
                src="{{ image | img_url: '900x900' }}"
                alt="{{ image.alt | escape }}"
                class="w-full max-h-[576px] object-contain m-auto"
                width="576"
                height="576"
              >
              <!-- Zoom overlay button (appears on hover) -->
              <button
                type="button"
                class="slide-zoom-btn absolute top-3 right-3 opacity-0 group-hover:!opacity-100 group-focus:opacity-100 transition bg-black bg-opacity-60 hover:bg-opacity-80 rounded-full w-9 h-9 flex items-center justify-center text-white z-40 m-tooltip--left"
                data-slide-index="{{ forloop.index0 }}"
                aria-label="Zoom image"
              >
                {% render 'icon-svg-zoom-in', class: 'size-5 pointer-events-none text-white' %}
                <span class="m-tooltip__content hidden bg-black text-white text-xs rounded px-2 py-1 whitespace-nowrap shadow z-50">
                  Zoom in
                </span>
              </button>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- prev/next arrows (absolute, vertically centered) -->
    <div data-glide-el="controls">
      <button class="product-gallery-arrow product-gallery-arrow--left focus-visible:outline-none" data-glide-dir="<" aria-label="Previous">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="product-gallery-arrow product-gallery-arrow--right focus-visible:outline-none" data-glide-dir=">" aria-label="Next">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <!-- Thumbnails carousel -->
    {% if show_thumbs != false %}
      <div class="mt-3" data-glide-el="controls[nav]">
        <div class="glide product-thumbs" id="esProductThumbs">
          <div class="glide__track" data-glide-el="track">
            <ul class="glide__slides">
              {% for image in product.images %}
                <li class="glide__slide px-1 max-w-32">
                  <button class="thumb-btn focus:outline-none" data-thumb-index="={{ forloop.index0 }}">
                    <img
                      src="{{ image | img_url: '250x250' }}"
                      alt="{{ image.alt | escape }}"
                      class="rounded max-h-[110px] object-contain m-auto"
                      width="110"
                      height="110"
                    >
                  </button>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<!-- Lightbox modal (Glide slider) -->
<div id="product-lightbox" class="hidden fixed inset-0 z-55 bg-white bg-opacity-75 items-center justify-center p-4">
  <div class="w-full max-w-4xl relative">
    <div class="glide glide-lightbox" id="product-lightbox-glide">
      <div class="glide__track" data-glide-el="track">
        <ul class="glide__slides">
          {% for image in product.images %}
            <li class="glide__slide">
              <img
                src="{{ image | img_url: '1200x1200' }}"
                alt="{{ image.alt | escape }}"
                class="w-auto h-auto max-h-[90vh] m-auto"
                height="900"
                width="900"
              >
            </li>
          {% endfor %}
        </ul>
      </div>

      <!-- lightbox close (positioned top-right of container) -->
      <button
        id="product-lightbox-close"
        class="absolute top-2 right-2 text-white text-2xl bg-black bg-opacity-40 rounded-full w-8 h-8 flex items-center justify-center"
      >
        &times;
      </button>
      <!-- optional prev/next for lightbox -->
      <button class="product-gallery-arrow product-gallery-arrow--left" data-glide-dir="<" aria-label="Previous">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="product-gallery-arrow product-gallery-arrow--right" data-glide-dir=">" aria-label="Next">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<script src="{{ 'product-media.js' | asset_url }}" defer></script>
