{%- comment -%} Quantity selector snippet. Renders - input + and exposes `name="quantity"` input. {%- endcomment -%}
 {%  assign mobile_hide = mobile_hide | default: false %}
{% if mobile_hide %}
  {% assign dynamic_class = "hidden sm:inline-flex" %}
{% else %}
  {% assign dynamic_class = "inline-flex" %}
{% endif %}

<div class="qty-selector items-center space-x-1 border p-2 rounded-lg shadow-lg {{ dynamic_class }}">
  <button type="button" class="cursor-pointer qty-decrement flex items-center justify-center hover:text-bg-light-red">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="size-4"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M5 12h14"/>
    </svg>
  </button>
  <input
    type="number"
    name="quantity"
    value="1"
    inputmode="numeric"
    pattern="[0-9]*"
    min="1"
    max="999"
    step="1"
    class="quantity-input w-9 text-center"
    aria-label="Quantity"
  >
  <button
    type="button"
    class="cursor-pointer qty-increment w-8 h-8 flex items-center justify-center hover:text-bg-light-red"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="size-4"
    >
      <path d="M5 12h14"/><path d="M12 5v14"/>
    </svg>
  </button>
</div>
<script>
  (function(){
    // Find the closest selector for this snippet instance
    var script = document.currentScript;
    var container = script ? script.previousElementSibling : null;
    if(!container || !container.classList || !container.classList.contains('qty-selector')){
      // fallback: first instance on the page
      container = document.querySelector('.qty-selector');
    }
    if(!container) return;
    var input = container.querySelector('input[name="quantity"]');
    if(!input) return;

    function sanitize(val){
      if(val === undefined || val === null) return 1;
      var v = String(val).replace(/[^0-9]/g,'');
      if(v === '') return 1;
      var n = parseInt(v, 10);
      if(isNaN(n)) return 1;
      n = Math.max(1, n);
      n = Math.min(999, n);
      return n;
    }

    input.addEventListener('input', function(){
      // Immediately strip non-digits to keep value numeric while typing
      var v = this.value;
      if(!/^\d*$/.test(v)){
        this.value = v.replace(/[^0-9]/g,'');
      }
    });

    input.addEventListener('blur', function(){
      this.value = sanitize(this.value);
    });

    input.addEventListener('paste', function(e){
      var paste = (e.clipboardData || window.clipboardData).getData('text');
      var sanitized = sanitize(paste);
      e.preventDefault();
      this.value = sanitized;
    });
  })();
</script>
