{%- assign has_addons = false -%}
{%- for addon_check in cart.items -%}
  {%- if addon_check.properties.parent_key == item.key -%}
    {%- assign has_addons = true -%}
  {%- endif -%}
{%- endfor -%}

{%- assign is_addon = false -%}
{%- if item.properties.is_addon == 'true' -%}
  {%- assign is_addon = true -%}
{%- endif -%}
{%- assign in_drawer = false -%}
{%- if drawer == true or drawer == 'true' -%}
  {%- assign in_drawer = true -%}
{%- endif -%}

<div
  class="py-4 flex flex-col sm:flex-row sm:items-center sm:space-x-4 border-b border-grey"
>
  <!-- Product column -->
  <div class="md:flex-1 flex items-start space-x-4">
    {% if item.image %}
      <a href="{{ item.url }}" class="inline-block">
        <img
          src="{{ item.image | img_url: '300x' }}"
          alt="{{ item.title }}"
          class="size-28 object-contain border border-grey p-2 rounded"
          width="80"
          height="80"
        >
      </a>
    {% else %}
      <div class="size-28 bg-gray-100 rounded"></div>
    {% endif %}

    <div class="flex-1">
      <div class="text-sm font-semibold">
        <a href="{{ item.url }}" class="hover:underline">{{ item.title }}</a>
      </div>

      {%- assign show_options = false -%}
      {%- if item.options_with_values -%}
        {%- for opt in item.options_with_values -%}
          {%- if opt.value and opt.value != 'Default Title' -%}
            {%- assign show_options = true -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      {%- if show_options -%}
        <div class="text-sm text-gray-600">
          {%- for opt in item.options_with_values -%}
            <span class="block">{{ opt.name }}: {{ opt.value }}</span>
          {%- endfor -%}
        </div>
      {%- elsif item.variant.title != 'Default Title' -%}
        <div class="text-sm text-gray-600">{{ item.variant.title }}</div>
      {%- endif -%}

      {% if has_addons %}
        <div class="mt-2">
          <button
            type="button"
            class="view-fixings-btn text-xs text-gray-600 flex items-center gap-1 underline"
            data-parent-key="{{ item.key }}"
          >
            <span>View Fixings</span>
            {% render 'icon-svg-arrow-right', class: 'size-4 view-fixings-icon transition-transform duration-200' %}
          </button>
          <div
            class="fixings-panel overflow-hidden mt-2"
            style="max-height:0; transition:max-height 300ms ease;"
          >
            {% render 'cart-fixing-list', parent_key: item.key %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Price -->
  <div class="sm:w-40 mx-auto mt-4 sm:mt-0 flex items-center justify-start sm:justify-center">
    {{ item.price | money }}
  </div>

  <!-- Quantity -->
  <div class="sm:w-36 mx-auto mt-4 sm:mt-0 flex items-center justify-start sm:justify-center">
    {% if in_drawer and is_addon %}
      <div class="text-sm text-gray-700">Qty: {{ item.quantity }}</div>
    {% else %}
      {% render 'cart-qty-control', key: item.key, qty: item.quantity, is_addon: has_addons %}
    {% endif %}
  </div>

  <!-- Total -->
  <div class="sm:w-40 mx-auto mt-4 sm:mt-0 flex items-center justify-start sm:justify-end font-semibold">
    {{ item.final_line_price | money }}
  </div>
</div>
