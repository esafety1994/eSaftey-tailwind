{% comment %}
  Simplified Product Card for Tailwind Theme
  Accepts:
  - product: {Object} Product (required)
  - show_vendor: {Boolean} Show product vendor (optional)
  - show_compare_price: {Boolean} Show compare at price (optional)
  - card_background: {String} Background color (optional)
  - card_border: {String} Border color (optional)
  - card_border_radius: {String} Border radius (optional)
  - card_padding: {String} Padding (optional)
  - title_size: {String} Title font size (optional)
  - title_color: {String} Title color (optional)
  - price_size: {String} Price font size (optional)
  - price_color: {String} Price color (optional)

  Uses separate snippets:
  - quick-view-btn.liquid for Quick View functionality
  - quick-add-btn.liquid for Quick Add functionality
  - product-price.liquid for Price display with GST information
  - product-tags.liquid for Filtered product tags with custom styling
{% endcomment %}

{% comment %}
  TO Dos:
  - ratings
  - stock level indicator
  - price formatting options
{% endcomment %}
{% liquid
  assign show_vendor = show_vendor | default: false
  assign show_compare_price = show_compare_price | default: true
  assign card_background = card_background | default: '#ffffff'
  assign card_border = card_border | default: '#D6D4D4'
  assign card_border_radius = card_border_radius | default: '0'
  assign card_padding = card_padding | default: '15px'
  assign title_size = title_size | default: '18px'
  assign title_color = title_color | default: '#000000'
  assign price_size = price_size | default: '16px'
  assign price_color = price_color | default: '#000000'
  assign max_tags = max_tags | default: 0
%}

{% comment %} Try to resolve a full product object from `all_products` if `product` appears to be a shallow drop (handles may be present) {% endcomment %}
{% assign prod = product %}
{% if product.handle and all_products[product.handle] %}
  {% assign prod = all_products[product.handle] %}
{% endif %}
<article
  class="product-card flex flex-col overflow-hidden transition-transform transform p-1.5 md:h-full max-w-sm m-auto 2xl:max-w-none"
  style="background-color: {{ card_background }}; border: 1px solid {{ card_border }}; border-radius: {{ card_border_radius }}px;"
>
  <div class="relative overflow-hidden">
    <div class="block relative w-full z-10 group" style="padding-bottom: 100%;">
      {%- comment -%} image skeleton removed â€” skeleton no longer used {%- endcomment -%}
      {% render 'product-badges', product: prod %}
      <div class="badges absolute top-3 right-2 z-40 flex flex-col items-end gap-2">
        {% render 'quotify-button', product: prod, layout: 'card' %}
      </div>
      <a href="{{ prod.url }}" class="absolute inset-0 z-20 block">
        {% if prod.featured_image %}
          {% if prod.images[1] %}
            {% assign hover_url = prod.images[1] | image_url: width: 600 %}
            <img
              src="{{ hover_url }}"
              data-hover-src="{{ hover_url }}"
              alt="{{ prod.images[1].alt | default: prod.title | escape }}"
              class="absolute inset-0 w-full h-full object-contain transition-all duration-300 opacity-0 group-hover:!opacity-100 group-hover:scale-105 z-20 hover-image"
              loading="lazy"
              width="600"
              height="600"
            >
          {% endif %}
          {% if prod.featured_image %}
            {% assign featured_class = 'absolute inset-0 w-full h-[280px] md:h-full object-contain transition-all duration-300' %}
            {% if prod.images[1] %}
              {% assign featured_class = featured_class | append: ' group-hover:opacity-0' %}
            {% else %}
              {% assign featured_class = featured_class | append: ' group-hover:scale-105' %}
            {% endif %}
            {% render 'responsive-image',
              image: prod.featured_image,
              image_class: featured_class,
              wrapper_class: 'absolute inset-0 z-10'
            %}
          {% endif %}
        {% else %}
          <div class="absolute inset-0 flex items-center justify-center bg-gray-100">
            {{ 'product-1' | placeholder_svg_tag }}
          </div>
        {% endif %}
      </a>
      {% render 'card-add-to-cart', product: prod %}
    </div>
  </div>
  <div class="flex flex-col gap-2 flex-grow justify-between px-3">
    <a
      href="{{ prod.url }}"
      class="font-bold line-clamp-3 md:min-h-[81px]"
      style="font-size: {{ title_size }}; color: {{ title_color }}; font-weight: 500;"
    >
      {{ prod.title }}
    </a>
    <div class="flex items-center justify-between flex-wrap">
      {% render 'product-price',
        product: prod,
        show_compare_price: show_compare_price,
        price_size: price_size,
        price_color: price_color,
        layout: 'card'
      %}
      {% render 'product-review', product: prod, layout: 'card' %}
      {% render 'product-stock-badge', product: prod %}
    </div>
  </div>
</article>
