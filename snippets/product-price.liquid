{% comment %}
  Product Price Snippet
  Displays product price with optional compare price and GST information
  Accepts:
  - product: {Object} Product (required)
  - show_compare_price: {Boolean} Show compare at price (optional, default: true)
  - price_size: {String} Price font size (optional, default: '14px')
  - price_color: {String} Price color (optional, default: '#000000')
{% endcomment %}
{% liquid
  assign show_compare_price = show_compare_price | default: true
  assign price_size = price_size | default: '16px'
  assign price_color = price_color | default: '#000000'
  assign show_ex_gst = show_ex_gst | default: false
  assign req_from = req_from | default: 'normal'
%}
<div
  class="grid gap-2 my-4 items-center"
  style="font-size: {{ price_size }}; color: {{ price_color }};"
>
  {% if req_from == 'sticky' %}
    <div class="text-left">
      <span class="font-semibold">
        <span>{{ product.price | money }}</span>
        {% if product.tags contains 'isgstexempt' %}
          <span class="ml-2 text-sm">(ex. GST)</span>
        {% else %}
          <span class="ml-2 text-sm">(inc GST)</span>
        {% endif %}
        {% if product.compare_at_price > product.price and show_compare_price %}
          <span>
            <span class="text-gray-500 line-through mr-2">
              {{ product.compare_at_price | money }}
            </span>
            {% if req_from != 'sticky' %}
              <span class="text-green-600">Save: {{ product.compare_at_price | minus: product.price | money }}</span>
            {% endif %}
          </span>
        {% endif %}
      </span>
      {% if show_ex_gst %}
        {% comment %} Calculate price excluding 10% GST. product.price is in cents, so divide by 1.1 then round to nearest cent. {% endcomment %}
        {% assign ex_price = product.price | divided_by: 1.1 | round %}
        <div class="text-base text-gray-600">{{ ex_price | money }} (ex. GST)</div>
      {% endif %}
    </div>

  {% else %}
    <span class="font-semibold">
      <span>{{ product.price | money }}</span>
      {% if product.tags contains 'isgstexempt' %}
        <span>
          <span class="ml-2 text-sm">(GST Exempt)</span>
        </span>
      {% else %}
        <span class="ml-2 text-sm">(inc GST)</span>
      {% endif -%}
      {% if product.compare_at_price > product.price and show_compare_price %}
        <span>
          <span class="text-gray-500 line-through mr-2">
            {{ product.compare_at_price | money }}
          </span>
          {% if req_from != 'sticky' %}
            <span class="text-green-600">Save: {{ product.compare_at_price | minus: product.price | money }}</span>
          {% endif %}
        </span>
      {% endif %}
    </span>
    {% if show_ex_gst %}
      {% comment %} Calculate price excluding 10% GST. product.price is in cents, so divide by 1.1 then round to nearest cent. {% endcomment %}
      {% assign ex_price = product.price | divided_by: 1.1 | round %}
      <span class="text-base text-gray-600">{{ ex_price | money }} (ex. GST)</span>
    {% endif %}
  {% endif %}
</div>
