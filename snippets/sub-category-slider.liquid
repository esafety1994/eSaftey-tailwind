{%- comment -%}
  Sub Category Slider
  - Expects: `collection_list` as an array of collection objects (CollectionListDrop or array)
  - Usage: {% render 'sub-category-slider', collection_list: collection_list %}
{%- endcomment -%}

{%- assign slider_uid = section.id | default: 'global' -%}
{%- assign slider_id = 'subcat-' | append: slider_uid -%}

<div class="glide sub-category-glide relative" id="{{ slider_id }}">
  <div class="glide__track" data-glide-el="track">
    <ul class="glide__slides">
      {% for col in collection_list %}
        <li class="glide__slide px-2 !h-auto">
          <a
            href="{{ col.url }}"
            class="h-full flex justify-center items-start bg-[#fee9a7] rounded-md p-4 hover:shadow-md focus:shadow-md transition-shadow"
          >
            <div class="flex flex-col items-start gap-3">
              <div class="w-full h-full overflow-hidden rounded-md">
                {% if col.image != blank %}
                  {% render 'responsive-image',
                    image: col.image,
                    alt: col.title,
                    image_class: 'w-full h-28 object-cover'
                  %}
                {% else %}
                  <div class="w-full h-28 bg-gray-100 flex items-center justify-center">
                    {{ 'image' | placeholder_svg_tag }}
                  </div>
                {% endif %}
              </div>
              <div class="w-full mt-auto">
                <h3 class="text-lg text-center">{{ col.title }}</h3>
              </div>
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
  <div class="glide__arrows" data-glide-el="controls">
    <button class="product-gallery-arrow product-gallery-arrow--left" data-glide-dir="<" aria-label="Previous">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <button class="product-gallery-arrow product-gallery-arrow--right" data-glide-dir=">" aria-label="Next">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var subCategoryGlide = new Glide('.sub-category-glide', {
      type: 'slider',
      startAt: 0,
      perView: 6,
      rewind: false,
      gap: 10,
      breakpoints: {
        1024: { perView: 3 },
        768: { perView: 2 },
        480: { perView: 1 },
      },
    });
    var prevBtn = document.querySelector('.sub-category-glide .product-gallery-arrow--left');
    var nextBtn = document.querySelector('.sub-category-glide .product-gallery-arrow--right');

    function updateArrows() {
      var index = subCategoryGlide.index;
      var perView = subCategoryGlide.settings.perView;
      var slidesCount = subCategoryGlide.track.details.slides.length;

      // Disable PREV on first slide
      if (index === 0) {
        prevBtn.disabled = true;
        prevBtn.classList.add('disabled');
      } else {
        prevBtn.disabled = false;
        prevBtn.classList.remove('disabled');
      }

      // Disable NEXT on last slide view
      if (index >= slidesCount - perView) {
        nextBtn.disabled = true;
        nextBtn.classList.add('disabled');
      } else {
        nextBtn.disabled = false;
        nextBtn.classList.remove('disabled');
      }
    }

    // Run on load and after each move
    subCategoryGlide.on(['mount.after', 'run.after'], updateArrows);

    subCategoryGlide.mount();
  });
</script>
