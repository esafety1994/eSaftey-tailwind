{% comment %} Vertical accordion megamenu using a linklist passed as `menu_handle` {% endcomment %}
{% assign menu = linklists[menu_handle] %}
{% if menu and menu.links.size > 0 %}
  <nav class="mega-menu w-full text-black">
    <ul class="space-y-1">
      {% for item in menu.links %}
        <li>
          {% if item.links and item.links.size > 0 %}
            {% assign has_children = true %}
          {% else %}
            {% assign has_children = false %}
          {% endif %}

          {% assign outer_index = forloop.index %}
          {% assign ns_outer = menu_handle | append: '-' | append: outer_index %}
          <div class="flex w-full items-center justify-between">
            {% if has_children %}
              <a
                href="{{ item.url }}"
                class="mega-item-link bg-white text-left flex-1 p-3 hover:bg-[#FDDC14] font-semibold"
                data-has-children="true"
                data-index="{{ ns_outer }}"
                data-title="{{ item.title }}"
              >
                {{- item.title -}}
              </a>
            {% else %}
              <a href="{{ item.url }}" class="bg-white font-semibold text-left flex-1 p-3 hover:bg-[#FDDC14] font-semibold">
                {{- item.title -}}
              </a>
            {% endif %}
          </div>

          {% if has_children %}
            <div id="mega-{{ ns_outer }}" class="mega-panel bg-[#f5f4f4]">
              <ul class="mt-2 space-y-0">
                {% for child in item.links %}
                  {% assign child_index = forloop.index %}
                  {% assign ns_child = ns_outer | append: '-' | append: child_index %}
                  <li>
                    {% if child.links and child.links.size > 0 %}
                      {% assign has_grand = true %}
                    {% else %}
                      {% assign has_grand = false %}
                    {% endif %}

                    {% if has_grand %}
                      <div class="flex w-full items-center justify-between">
                        <a
                          href="{{ child.url }}"
                          class="mega-item-link block text-sm text-black pl-3 py-3 flex-1 font-normal hover:bg-[#FDDC14] hover:text-black"
                          data-has-children="true"
                          data-index="{{ ns_child }}"
                          data-title="{{ child.title }}"
                        >
                          {{- child.title -}}
                        </a>
                        <button
                          class="mega-toggle ml-2 p-1"
                          aria-expanded="false"
                          data-target="mega-{{ ns_child }}"
                          aria-label="Toggle {{ child.title }} submenu"
                        ></button>
                      </div>

                      <div id="mega-{{ ns_child }}" class="mega-panel bg-[#e6e6e6]">
                        <ul class="mt-2 space-y-0">
                          {% for grand in child.links %}
                            <li>
                              <a
                                href="{{ grand.url }}"
                                class="block text-sm text-black pl-3 py-3 font-normal hover:bg-[#FDDC14] hover:text-black"
                              >
                                {{- grand.title -}}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    {% else %}
                      <a
                        href="{{ child.url }}"
                        class="block text-sm text-black pl-3 py-3 font-normal hover:bg-[#FDDC14] hover:text-black"
                      >
                        {{- child.title -}}
                      </a>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </nav>
{% else %}
  <div class="text-sm text-gray-400">No menu assigned.</div>
{% endif %}
<div class="hidden">
  {% render 'top-navbar' %}
</div>
