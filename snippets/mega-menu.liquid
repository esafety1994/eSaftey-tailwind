{% comment %} Vertical accordion megamenu using a linklist passed as `menu_handle` {% endcomment %}
{% assign menu = linklists[menu_handle] %}
{% if menu and menu.links.size > 0 %}
  <nav class="mega-menu w-full text-black">
    <ul class="space-y-1">
      {% for item in menu.links %}
        {% assign obj = item.object %}

        <li>
          {% if item.links and item.links.size > 0 %}
            {% assign has_children = true %}
          {% else %}
            {% assign has_children = false %}
          {% endif %}

          {% assign outer_index = forloop.index %}
          {% assign ns_outer = menu_handle | append: '-' | append: outer_index %}
          <div class="flex w-full items-center justify-between">
            {% if has_children %}
              <a
                href="#"
                data-href="{{ item.url }}"
                class="mega-item-link bg-white text-left flex-1 p-3 hover:bg-[#FDDC14] font-semibold capitalize flex gap-2 items-center h-14"
                data-has-children="true"
                data-index="{{ ns_outer }}"
                data-title="{{ item.title }}"
              >
                {% if obj and obj.metafields.menu.icon %}
                  <img
                    src="{{ obj.metafields.menu.icon | image_url: width: 32 }}"
                    alt="{{ link.title }}"
                    class="menu-icon"
                    width="32"
                    height="32"
                  >
                {% endif %}
                <span class="root-menu-title">{{- item.title | downcase -}}</span>
              </a>
            {% else %}
              <a
                href="{{ item.url }}"
                class="bg-white text-left flex-1 p-3 hover:bg-[#FDDC14] font-semibold capitalize"
              >
                {{- item.title | downcase -}}
              </a>
            {% endif %}
          </div>

          {% if has_children %}
            <div id="mega-{{ ns_outer }}" class="mega-panel bg-[#f5f4f4]">
              <ul class="mt-2 space-y-0">
                {% for child in item.links %}
                  {% assign child_index = forloop.index %}
                  {% assign ns_child = ns_outer | append: '-' | append: child_index %}
                  <li>
                    {% if child.links and child.links.size > 0 %}
                      {% assign has_grand = true %}
                    {% else %}
                      {% assign has_grand = false %}
                    {% endif %}

                    {% if has_grand %}
                      <div class="flex w-full items-center justify-between">
                        <a
                          href="#"
                          data-href="{{ child.url }}"
                          class="mega-item-link block text-black flex-1 font-normal hover:bg-[#FDDC14] hover:text-black  "
                          data-has-children="true"
                          data-index="{{ ns_child }}"
                          data-title="{{ child.title }}"
                        >
                          <span class="border-b border-b-gray-300  ml-10 mr-10 py-4 block">
                            {{- child.title | downcase -}}
                          </span>
                        </a>
                      </div>

                      <div id="mega-{{ ns_child }}" class="mega-panel bg-[#e6e6e6]">
                        <ul class="mt-2 space-y-0">
                          {% for grand in child.links %}
                            <li>
                              <a
                                href="{{ grand.url }}"
                                class="block text-black hover:bg-[#FDDC14] hover:text-black capitalize test"
                              >
                                <span class="border-b border-b-gray-300  ml-10 mr-10 py-4 block">{{- grand.title | downcase -}}</span>
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    {% else %}
                      <a
                        href="{{ child.url }}"
                        class="block text-black hover:bg-[#FDDC14] hover:text-black capitalize test"
                      >
                       <span class="border-b border-b-gray-300  ml-10 mr-10 py-4 block"> {{- child.title | downcase -}}</span>
                      </a>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </nav>
{% else %}
  <div class="text-sm text-gray-400">No menu assigned.</div>
{% endif %}
<div class="hidden">
  {% render 'top-navbar' %}
</div>
