{% assign layout = layout | default: "base" %}
<div
  class="ruk_rating_snippet flex items-center {% if layout == 'PDP' %}justify-start{% else %}justify-center{% endif %}"
  data-sku="{{ product.handle }};{{ product.variants | map: 'sku' | join: ';' }};{{ product.variants | map: 'id' | join: ';' }}"
>
  <i aria-hidden="true" class="ruk-icon-percentage-star--0"></i
  ><i aria-hidden="true" class="ruk-icon-percentage-star--0"></i
  ><i aria-hidden="true" class="ruk-icon-percentage-star--0"></i
  ><i aria-hidden="true" class="ruk-icon-percentage-star--0"></i
  ><i aria-hidden="true" class="ruk-icon-percentage-star--0"></i
  ><span aria-hidden="true" class="ruk-rating-snippet-count" style="color: rgb(51, 51, 51);">(0)</span>
</div>

<link rel="stylesheet" href="https://widget.reviews.io/rating-snippet/dist.css">
<script>
  (function () {
    if (window.__ratingSnippetInit) return;
    window.__ratingSnippetInit = true;
    var opts = {
      store: 'esafety-supplies',
      color: '#0E1311',
      linebreak: true,
      usePolaris: true,
      text: '',
    };

    function run() {
      if (window.ratingSnippet && typeof window.ratingSnippet === 'function') {
        try {
          window.ratingSnippet('ruk_rating_snippet', opts);
        } catch (e) {
          console.error('ratingSnippet call error', e);
        }
        return;
      }

      // If script tag already present, listen for its load event
      var existing = document.querySelector('script[data-rating-snippet]');
      if (existing) {
        existing.addEventListener('load', function () {
          if (window.ratingSnippet) window.ratingSnippet('ruk_rating_snippet', opts);
        });
        return;
      }

      // Insert script and call on load
      var s = document.createElement('script');
      s.src = 'https://widget.reviews.io/rating-snippet/dist.js';
      s.defer = true;
      s.setAttribute('data-rating-snippet', '1');
      s.onload = function () {
        if (window.ratingSnippet) window.ratingSnippet('ruk_rating_snippet', opts);
      };
      s.onerror = function (e) {
        console.error('Failed to load rating-snippet', e);
      };
      document.head.appendChild(s);
    }

    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run);
    else run();
  })();
</script>
<style>
  .ruk_rating_snippet .ruk-rating-snippet-count {
    bottom: 0 !important;
    line-height: 0 !important;
  }
</style>
