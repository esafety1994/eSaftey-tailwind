<html>
  <head>
    <title>
      {{- page_title -}}
      {%- if current_tags -%}
        {%- assign meta_tags = current_tags | join: ', ' %} &ndash; {{ 'general.meta.tags' | t: tags: meta_tags -}}
      {%- endif -%}
      {%- if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif -%}
      {%- if template == 'password' -%}
        {{- shop.name -}}
      {%- else -%}
        {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
      {%- endif -%}
    </title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <meta name="viewport" content="width=device-width, initial-scale=1">

    {{ content_for_header }}

    {% comment %}
      Load Poppins from Google Fonts and set as CSS variable for Tailwind
    {% endcomment %}

    {% assign font_handle = settings.type_base_font | default: 'poppins_n4' %}

    <!-- Load Poppins from Google Fonts (preconnect + preload for performance) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" onload="this.rel='stylesheet'">
    <noscript>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    </noscript>

    <style>
      :root {
        /* Force Poppins as the default font for the theme */
        --default-font-family: 'Poppins', sans-serif;
      }

      /* Ensure common weight classes use Poppins */
      .font-normal { font-family: 'Poppins', sans-serif !important; font-weight: 400; }
      .font-semibold { font-family: 'Poppins', sans-serif !important; font-weight: 600; }
      .font-bold { font-family: 'Poppins', sans-serif !important; font-weight: 700; }
    </style>
    {{ 'glide.core.min.css' | asset_url | stylesheet_tag }}
    {{ 'tailwind.output.css' | asset_url | stylesheet_tag }}
    {{ 'global.css' | asset_url | stylesheet_tag }}
    {%- if template == 'product' -%}
      {{ 'product.css' | asset_url | stylesheet_tag }}
    {%- endif -%}
  </head>
  <body class="font-normal">
    {% sections 'header-group' %}
    <main id="main" role="main">
      {{ content_for_layout }}
    </main>
    <script>
      (function(){
        var glideUrl = '{{ "glide.min.js" | asset_url }}';
        function loadGlide(){ if (window._glideLoaded) return; window._glideLoaded = true; var s = document.createElement('script'); s.src = glideUrl; s.defer = true; document.body.appendChild(s); }
        // If a carousel exists, load immediately
        if (document.querySelector && document.querySelector('.glide')) { loadGlide(); return; }
        // Observe DOM for dynamically inserted carousels
        if ('MutationObserver' in window) {
          var obs = new MutationObserver(function(){ if (document.querySelector('.glide')) { loadGlide(); obs.disconnect(); } });
          obs.observe(document.documentElement || document.body, { childList: true, subtree: true });
        }
        // Fallback: load after short delay to ensure functionality
        setTimeout(function(){ if (!window._glideLoaded && document.querySelector('.glide')) loadGlide(); }, 2500);
      })();
    </script>
    {%- if template == 'product' -%}
      <script defer src="{{ 'product-details.js' | asset_url }}"></script>
    {%- endif -%}
    <script defer src="{{ 'cart.js' | asset_url }}"></script>
    <script defer src="{{ 'theme.js' | asset_url }}"></script>
    <script defer src="{{ 'cart-item-control.js' | asset_url }}"></script>
    {% sections 'footer-group' %}
  </body>
</html>
