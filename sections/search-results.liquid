<script defer src="{{ 'collection-filter.js' | asset_url }}"></script>

<section id="search-section-{{ section.id }}" class="container mx-auto px-4 py-8 max-w-7xl">
  <div class="mb-6">
    {% if search %}
      <h1 class="text-4xl font-semibold text-center">Search Results</h1>
      {% if search.terms != blank %}
        <p class="text-center text-gray-600 mt-2">Found {{ search.results_count }} results for "{{ search.terms }}"</p>
      {% endif %}
    {% endif %}
  </div>

  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 collection-inner-element">
    <aside class="hidden md:block md:col-span-3">
      {% if section.settings.show_filters %}
        <div class="sticky top-56 mt-12">
          <div class="p-2 px-4 border border-gray-200 rounded-lg mb-2">
            <h3 class="text-lg mb-4">Filters</h3>
            <span class="text-sm mb-2 block">Sort By: <span data-sort-display>Featured</span></span>
            <div>
              {% assign filter_blank = true %}
              {% comment %} render active filter tokens (if any) {% endcomment %}
               
              {% for filter in search.filters %}
                {% for value in filter.active_values %}
                  {% assign filter_blank = false %}
                  <input
                    data-remove-url="{{ value.url_to_remove }}"
                    type="hidden"
                    value="{{ filter.value | handle }}"
                    name="{{ filter.label | handle }}"
                  >
                  <label
                    for="{{filter.label | handle}}-{{value.label | handle}}"
                    class="text-sm text-black cursor-pointer bg-gray-100 rounded-full px-3 py-1 inline-flex mb-2 mr-2 items-center gap-1"
                  >
                    {{ value.label }}
                    {% render 'icon-svg-close', class: 'size-3', stroke_width: '1' %}
                  </label>
                {% endfor %}
              {% endfor %}

              {%- comment -%} Render active price range as a pill for search results {%- endcomment -%}
              {% for filter in search.filters %}
                {% if filter.type != 'list' %}
                  {% if filter.min_value.value or filter.max_value.value %}
                    {% assign pmin = filter.min_value.value | divided_by: 100.0 | round: 2 %}
                    {% assign pmax = filter.max_value.value | divided_by: 100.0 | round: 2 %}
                    <label
                      data-remove-price
                      data-section-id="{{ section.id }}"
                      data-min-param="{{ filter.min_value.param_name }}"
                      data-max-param="{{ filter.max_value.param_name }}"
                      class="text-sm text-black cursor-pointer bg-gray-100 rounded-full px-3 py-1 inline-flex mb-2 mr-2 items-center gap-2"
                    >
                      ${{ pmin }} - ${{ pmax }}
                      {% render 'icon-svg-close', class: 'size-3', stroke_width: '1' %}
                    </label>
                  {% endif %}
                {% endif %}
              {% endfor %}

              {% unless filter_blank %}
                <span
                  data-clear-filters
                  class="mb-4 text-sm text-bg-light-red cursor-pointer bg-gray-200 rounded-full px-3 py-1 inline-flex mr-2 items-center gap-1"
                  >Clear filters {% render 'icon-svg-close', class: 'size-3', stroke_width: '1' -%}
                </span>
              {% endunless %}
            </div>
          </div>

          {% comment %} Reuse the collection filter UI but provide `collection` as the `search` object so snippet finds `filters` {% endcomment %}
          {% render 'collection-filter', filter_mode: 'search' %}
        </div>
      {% endif %}
    </aside>

    <div class="md:col-span-9">
      {% render 'sort-dropdown', base_url: search.url, section_id: section.id %}
      {% if search.results_count == 0 %}
        <div class="text-center py-24">
          <p class="text-gray-600">No results found</p>
        </div>
      {% else %}
        {% paginate search.results by section.settings.products_per_page %}
          {% assign cols = section.settings.columns %}
          {% assign col_class = 'md:grid-cols-3' %}
          {% if cols == '2' %}
            {% assign col_class = 'md:grid-cols-2' %}
          {% elsif cols == '3' %}
            {% assign col_class = 'md:grid-cols-3' %}
          {% elsif cols == '4' %}
            {% assign col_class = 'md:grid-cols-4' %}
          {% endif %}

          <div class="grid grid-cols-1 md:grid-cols-2 {{ col_class }} gap-6">
            {% for result in search.results %}
              {% if result.object_type == 'product' %}
                {% assign prod = result %}
                {% if prod.handle and all_products[prod.handle] %}
                  {% assign prod = all_products[prod.handle] %}
                {% endif %}

                <div class="w-full">
                  {% render 'product-card', product: prod, max_tags: 2 %}
                </div>
              {% endif %}
            {% endfor %}
          </div>

          {% render 'pagination', paginate: paginate, base_url: search.url %}
        {% endpaginate %}
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Search Results",
  "settings": [
    { "type": "number", "id": "products_per_page", "label": "Products per page", "default": 12 },
    {
      "type": "select",
      "id": "columns",
      "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" }
      ],
      "default": "3"
    },
    { "type": "checkbox", "id": "show_filters", "label": "Show filters column", "default": true }
  ],
  "presets": [{ "name": "Search Results", "category": "Search" }]
}
{% endschema %}
