{% comment %}
  Section: Collection Tabs
  Allows selecting 3 collections in the editor and displays them as tabs.
  Each tab shows up to 8 products in a 2-column grid (total 8: 2 columns x 4 rows).
{% endcomment %}
<section id="collection-tabs-{{ section.id }}" class="section-collection-tabs py-8 mt-6">
  <div class="container mx-auto px-4">
    <div class="tabs mb-6 flex gap-3 sm:gap-6 lg:gap-12 justify-between" role="tablist">
      {% assign collections_list = '' | split: ',' %}
      {% for i in (1..3) %}
        {% assign key = 'collection_' | append: i %}
        {% assign col_setting = section.settings[key] %}
        {% if col_setting != blank and collections[col_setting] %}
          {% assign col = collections[col_setting] %}
          {% assign collections_list = collections_list %}
          <button
            id="tab-{{ section.id }}-{{ forloop.index0 }}"
            type="button"
            class="tab-btn uppercase text-gray-400 font-semibold text-2xl lg:text-4xl hover:text-black"
            data-tab-index="{{ forloop.index0 }}"
            role="tab"
            aria-controls="collection-panel-{{ section.id }}-{{ forloop.index0 }}"
            aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
          >
            {{ col.title }}
          </button>
        {% else %}
          <button
            id="tab-{{ section.id }}-{{ forloop.index0 }}"
            type="button"
            class="tab-btn px-4 py-2 opacity-50 cursor-not-allowed"
            disabled
            aria-disabled="true"
            aria-selected="false"
          >
            Select collection
          </button>
        {% endif %}
      {% endfor %}
    </div>

    <div class="tab-panels">
      {% for i in (1..3) %}
        {% assign key = 'collection_' | append: i %}
        {% assign col_setting = section.settings[key] %}
        {% assign panel_index = forloop.index0 %}
        <div
          id="collection-panel-{{ section.id }}-{{ panel_index }}"
          class="tab-panel {% unless forloop.first %}hidden{% endunless %}"
          role="tabpanel"
          aria-labelledby="tab-{{ section.id }}-{{ panel_index }}"
        >
          {% if col_setting != blank and collections[col_setting] %}
            {% assign col = collections[col_setting] %}
            <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-y-12">
              {% for product in col.products limit: 8 %}
                <div>{% render 'product-card', product: product %}</div>
              {% endfor %}
            </div>
            <div class="pt-16 text-center">
              <a href="{{ col.url }}" class="btn primary-button-bordered">View more</a>
            </div>
          {% else %}
            <p class="text-sm text-gray-500">No collection selected for this tab.</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <style>
    /* Minimal styles to ensure spacing works even without Tailwind build */
    #collection-tabs-{{ section.id }} .tab-btn[aria-selected="true"]{color:#000;}
    #collection-tabs-{{ section.id }} .tab-btn.tab-active{color:#000;}
    #collection-tabs-{{ section.id }} .tab-panel.hidden{display:none}
  </style>

  <script>
    (function () {
      var root = document.getElementById('collection-tabs-{{ section.id }}');
      if (!root) return;

      var tabs = root.querySelectorAll('.tab-btn');
      var panels = root.querySelectorAll('.tab-panel');

      tabs.forEach(function (tab, idx) {
        tab.addEventListener('click', function () {
          if (tab.disabled) return;
          // deactivate all
          tabs.forEach(function (t) {
            t.setAttribute('aria-selected', 'false');
            t.classList.remove('ring-2');
            t.classList.remove('tab-active');
          });
          panels.forEach(function (p) {
            p.classList.add('hidden');
          });

          // activate clicked
          tab.setAttribute('aria-selected', 'true');
          tab.classList.add('tab-active');
          var tabIndex = (typeof tab.dataset.tabIndex !== 'undefined') ? tab.dataset.tabIndex : idx;
          var panel = root.querySelector('#collection-panel-{{ section.id }}-' + tabIndex);
          if (panel) panel.classList.remove('hidden');
        });
      });
    })();
  </script>

  {% schema %}
{
  "name": "Collection Tabs",
  "settings": [
    { "type": "collection", "id": "collection_1", "label": "Collection 1" },
    { "type": "collection", "id": "collection_2", "label": "Collection 2" },
    { "type": "collection", "id": "collection_3", "label": "Collection 3" }
  ],
  "presets": [{ "name": "Collection Tabs", "category": "Collections" }]
}
  {% endschema %}
</section>
