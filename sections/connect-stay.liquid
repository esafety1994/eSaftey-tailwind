{% comment %} Connect / Follow section - two column layout above footer {% endcomment %}
<div id="connect-stay-{{ section.id }}" class="bg-white border-t border-gray-100 py-10">
  <div class="max-w-7xl mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">

      <div class="follow-us">
        <h3 class="text-lg font-semibold mb-3">{{ section.settings.follow_title }}</h3>
        <div class="flex flex-wrap gap-3 items-center">
          {%- comment -%} Try store-level social accounts first (if available) {%- endcomment -%}
          {%- if section.settings.use_theme_social and shop.social_accounts -%}
            {%- for account in shop.social_accounts -%}
              {%- if account.url -%}
                <a href="{{ account.url }}" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900" target="_blank" rel="noopener noreferrer">
                  <span class="sr-only">{{ account.service_name }}</span>
                  {% case account.service_name | downcase %}
                    {% when 'facebook' %}
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.99H7.898v-2.888h2.54V9.797c0-2.507 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.462h-1.26c-1.242 0-1.63.771-1.63 1.562v1.875h2.773l-.443 2.888h-2.33v6.99C18.343 21.128 22 16.991 22 12z"/></svg>
                    {% when 'instagram' %}
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm5 6.5A4.5 4.5 0 1016.5 13 4.5 4.5 0 0012 8.5zm6.8-3.2a1.2 1.2 0 11-1.2-1.2 1.2 1.2 0 011.2 1.2z"/></svg>
                    {% when 'twitter' %}
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M22 5.924c-.63.28-1.3.47-2 .55a3.48 3.48 0 001.53-1.92 6.95 6.95 0 01-2.2.84 3.47 3.47 0 00-5.92 3.16A9.85 9.85 0 013 4.89a3.47 3.47 0 001.07 4.63 3.44 3.44 0 01-1.57-.43v.04a3.47 3.47 0 002.78 3.4 3.5 3.5 0 01-1.56.06 3.48 3.48 0 003.24 2.41A6.97 6.97 0 012 19.54a9.83 9.83 0 005.32 1.56c6.38 0 9.87-5.28 9.87-9.86v-.45A7.06 7.06 0 0022 5.924z"/></svg>
                    {% when 'youtube' %}
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 15l5.19-3L10 9v6zm12-6.5s0 1.77-.14 2.55c-.14.85-.56 1.44-1.04 1.86-.92.78-1.95.78-2.43.85-3.41.22-8.38.22-8.38.22S6.09 15.9 5.17 15.12C4.69 14.7 4.27 14.1 4.13 13.25 4 12.47 4 10.7 4 10.7S4 8.93 4.13 8.15C4.27 7.3 4.69 6.7 5.17 6.28 6.09 5.5 8.5 5.28 8.5 5.28s5-.01 8.38.22c.48.07 1.51.07 2.43.85.48.42.9 1.01 1.04 1.86.14.78.14 2.55.14 2.55z"/></svg>
                    {% when 'linkedin' %}
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M6.94 6.5a1.94 1.94 0 11.001-3.88A1.94 1.94 0 016.94 6.5zM4 9h6v11H4zM10 9h5.5v1.5h.1c.8-1.2 2.7-2.5 5.4-2.5V9H10z"/></svg>
                    {% else %}
                      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"/></svg>
                  {% endcase %}
                </a>
              {%- endif -%}
            {%- endfor -%}
          {%- endif -%}

          {%- comment -%} Manual social blocks (fallback or override) {%- endcomment -%}
          {%- for block in section.blocks -%}
            {% if block.type == 'social' and block.settings.url != blank %}
              <a href="{{ block.settings.url }}" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900" target="_blank" rel="noopener noreferrer">
                <span class="sr-only">{{ block.settings.label }}</span>
                {% case block.settings.icon %}
                  {% when 'instagram' %}
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm5 6.5A4.5 4.5 0 1016.5 13 4.5 4.5 0 0012 8.5zm6.8-3.2a1.2 1.2 0 11-1.2-1.2 1.2 1.2 0 011.2 1.2z"/></svg>
                  {% when 'facebook' %}
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.99H7.898v-2.888h2.54V9.797c0-2.507 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.462h-1.26c-1.242 0-1.63.771-1.63 1.562v1.875h2.773l-.443 2.888h-2.33v6.99C18.343 21.128 22 16.991 22 12z"/></svg>
                  {% when 'twitter' %}
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M22 5.924c-.63.28-1.3.47-2 .55a3.48 3.48 0 001.53-1.92 6.95 6.95 0 01-2.2.84 3.47 3.47 0 00-5.92 3.16A9.85 9.85 0 013 4.89a3.47 3.47 0 001.07 4.63 3.44 3.44 0 01-1.57-.43v.04a3.47 3.47 0 002.78 3.4 3.5 3.5 0 01-1.56.06 3.48 3.48 0 003.24 2.41A6.97 6.97 0 012 19.54a9.83 9.83 0 005.32 1.56c6.38 0 9.87-5.28 9.87-9.86v-.45A7.06 7.06 0 0022 5.924z"/></svg>
                  {% when 'linkedin' %}
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M6.94 6.5a1.94 1.94 0 11.001-3.88A1.94 1.94 0 016.94 6.5zM4 9h6v11H4zM10 9h5.5v1.5h.1c.8-1.2 2.7-2.5 5.4-2.5V9H10z"/></svg>
                  {% else %}
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"/></svg>
                {% endcase %}
              </a>
            {% endif %}
          {%- endfor -%}
        </div>
      </div>

      <div class="stay-in-touch">
        <h3 class="text-lg font-semibold mb-3">{{ section.settings.subscribe_title }}</h3>
        <p class="text-sm text-gray-600 mb-3">{{ section.settings.subscribe_text }}</p>

        <form id="connect-newsletter-{{ section.id }}" class="flex gap-2" method="post" action="/contact">
          <input type="hidden" name="form_type" value="contact">
          <input type="hidden" name="contact[tags]" value="newsletter">
          <label for="connect-email-{{ section.id }}" class="sr-only">Email</label>
          <input id="connect-email-{{ section.id }}" name="contact[email]" type="email" required placeholder="{{ section.settings.email_placeholder }}" class="w-full md:w-auto flex-1 px-3 py-2 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" />
          <button type="submit" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">{{ section.settings.subscribe_button_label }}</button>
        </form>

        <p id="connect-newsletter-msg-{{ section.id }}" class="mt-2 text-sm text-green-600 hidden"></p>
      </div>

    </div>
  </div>

  <script>
    (function(){
      var form = document.getElementById('connect-newsletter-{{ section.id }}');
      var msg = document.getElementById('connect-newsletter-msg-{{ section.id }}');
      if (!form) return;
      form.addEventListener('submit', function(e){
        e.preventDefault();
        var data = new FormData(form);
        fetch(form.action, { method: 'POST', body: data, credentials: 'same-origin' })
          .then(function(res){
            if (res.ok) return res.text();
            throw new Error('Network response was not ok');
          }).then(function(){
            msg.textContent = '{{ section.settings.success_message | escape }}';
            msg.classList.remove('hidden');
            form.reset();
          }).catch(function(){
            msg.textContent = '{{ section.settings.error_message | escape }}';
            msg.classList.remove('hidden');
          });
      });
    })();
  </script>
</div>

{% schema %}
{
  "name": "Connect / Stay in touch",
  "settings": [
    { "type": "text", "id": "follow_title", "label": "Follow title", "default": "Follow us" },
    { "type": "checkbox", "id": "use_theme_social", "label": "Use social links from brand settings (shop.social_accounts)", "default": true },
    { "type": "text", "id": "subscribe_title", "label": "Subscribe title", "default": "Let's stay in touch" },
    { "type": "textarea", "id": "subscribe_text", "label": "Subscribe subtext", "default": "Sign up for news and exclusive offers." },
    { "type": "text", "id": "email_placeholder", "label": "Email placeholder", "default": "Your email address" },
    { "type": "text", "id": "subscribe_button_label", "label": "Subscribe button label", "default": "Subscribe" },
    { "type": "text", "id": "success_message", "label": "Success message", "default": "Thanks â€” we'll be in touch." },
    { "type": "text", "id": "error_message", "label": "Error message", "default": "Sorry, something went wrong. Please try again." }
  ],
  "blocks": [
    { "type": "social", "name": "Social link", "settings": [
      { "type": "text", "id": "label", "label": "Label", "default": "Social" },
      { "type": "url", "id": "url", "label": "URL" },
      { "type": "select", "id": "icon", "label": "Icon", "options": [
        { "value": "facebook", "label": "Facebook" },
        { "value": "instagram", "label": "Instagram" },
        { "value": "twitter", "label": "Twitter" },
        { "value": "linkedin", "label": "LinkedIn" },
        { "value": "youtube", "label": "YouTube" }
      ] }
    ] }
  ],
  "max_blocks": 10,
  "presets": [{ "name": "Connect / Stay in touch", "category": "Footer" }]
}
{% endschema %}
