<script defer src="{{ 'collection-filter.js' | asset_url }}"></script>

<section id="collection-section-{{ section.id }}" class="container mx-auto px-4 py-8 max-w-7xl">
  <div class="mb-6">
    <h1 class="text-4xl font-semibold text-center">{{ collection.title }}</h1>
    {% if collection.metafields.custom.description_below_the_title != blank %}
      <p class="text-center my-4 text-base leading-loose">
        {{ collection.metafields.custom.description_below_the_title | newline_to_br }}
      </p>
    {% endif %}
  </div>
  <div class="mb-6">
    {%- assign collection_list = collection.metafields.custom.child_collections.value -%}

    {%- if collection_list != blank -%}
      {% render 'sub-category-slider', collection_list: collection_list %}
    {%- endif -%}
  </div>
  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 collection-inner-element">
    <aside class="hidden md:block md:col-span-3">
      {% if section.settings.show_filters %}
        <div class="sticky top-20">
          <h2 class="text-lg font-semibold mb-4">Filter</h2>
          {% render 'collection-filter' %}
        </div>
      {% endif %}
    </aside>

    <div class="md:col-span-9">
      <!-- todo sub cat listing from metafiled child category - -->
      <!-- todo sort feature drop down - -->
      {% paginate collection.products by section.settings.products_per_page %}
        {% assign cols = section.settings.columns %}
        {% assign col_class = 'md:grid-cols-3' %}
        {% if cols == '2' %}
          {% assign col_class = 'md:grid-cols-2' %}
        {% elsif cols == '3' %}
          {% assign col_class = 'md:grid-cols-3' %}
        {% elsif cols == '4' %}
          {% assign col_class = 'md:grid-cols-4' %}
        {% endif %}

        <div class="grid grid-cols-2 {{ col_class }} gap-6">
          {% for p in collection.products %}
            {% assign prod = p %}
            {% if p.handle and all_products[p.handle] %}
              {% assign prod = all_products[p.handle] %}
            {% endif %}
            <div class="w-full">
              {% render 'product-card', product: prod, max_tags: 2 %}
            </div>
          {% endfor %}
        </div>

        {% render 'pagination', paginate: paginate, base_url: collection.url %}
      {% endpaginate %}

      <div>
        {% render 'collection-video' %}

        {% render 'collection-faq', faq_data: collection.metafields.custom.faq_content_1.value %}

        <div class="my-12 shopify-content-box">
          {{ collection.metafields.custom.collection_description | metafield_tag }}
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Main Collection",
  "settings": [
    { "type": "number", "id": "products_per_page", "label": "Products per page", "default": 9 },
    {
      "type": "select",
      "id": "columns",
      "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" }
      ],
      "default": "3"
    },
    { "type": "checkbox", "id": "show_filters", "label": "Show filters column", "default": true }
  ],
  "blocks": [
    {
      "type": "breadcrumb",
      "name": "Breadcrumb",
      "settings": [{ "id": "breadcrumb_html", "type": "richtext", "label": "Breadcrumb HTML" }]
    },
    {
      "type": "custom_liquid",
      "name": "Custom Liquid/HTML",
      "settings": [{ "id": "custom_liquid", "type": "liquid", "label": "Liquid/HTML" }]
    }
  ],
  "max_blocks": 5,
  "presets": [{ "name": "Main Collection", "category": "Collection" }]
}
{% endschema %}
