let selectedSteps=new Set;function onSwatchReady(){moveVariantPicker(),moveProductPriceAboveQty(),attachAccordionDelegation(),createAccordionForSwatchContainer(),insertSteps4And5IntoApp(),setupAccordionStepAutoAdvance();try{updateProductGalleryWithSwatchImages()}catch(e){}document.querySelectorAll('select[name="Choose Material"], input[name="Choose Material"]').forEach(e=>{e.addEventListener("change",()=>{try{updateSizeOptions()}catch(e){}})}),document.addEventListener("change",e=>{const t=e.target;if(t&&t.matches&&t.matches('select[name="Choose Size"]')){const e=document.getElementById("custom-sign-selected-variant");e&&(e.value=t.value,e.dispatchEvent(new Event("change",{bubbles:!0})))}});try{updateSizeOptions()}catch(e){}try{wireVariantPriceUpdates()}catch(e){}}function wireVariantPriceUpdates(){const e=document.getElementById("custom-sign-selected-variant");if(!e)return;const t=e=>{if(null==e)return"";if(window.Shopify&&"function"==typeof window.Shopify.formatMoney)try{return window.Shopify.formatMoney(Number(e))}catch(e){}return(Number(e)/100).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2,style:"currency",currency:window.Shopify&&window.Shopify.currency&&window.Shopify.currency.active||"USD"})},o=e=>{if(!e)return;const o=(window.meta?.product?.variants||[]).find(t=>String(t.id)===String(e)||String(t.id)===String(Number(e))),n=document.getElementById("custom-sign-price-inc"),r=document.getElementById("custom-sign-price-ex");if(!o)return n&&(n.textContent=""),void(r&&(r.textContent=""));const c=null!=o.price?o.price:o.price_cents||o.price_in_cents||null;let i=null!=o.compare_at_price?o.compare_at_price:o.compare_at_price_cents||null;if(null==i&&null!=c){const e=Number(c);if(!Number.isNaN(e))try{i=Math.round(e/1.1)}catch(t){i=Math.round(.9*e)}}n&&(n.textContent=t(c)),r&&(r.textContent=i?t(i):"")};e.addEventListener("change",e=>{o(e.target.value)}),o(e.value)}function createAccordionForSwatchContainer(){const e=document.querySelector(".avp-option.ap-options__swatch-container");if(!e||e.closest(".accordion-wrapper"))return;const t=createAccordionDOM(1,"Choose Standard Template",!0);e.parentNode.insertBefore(t,e);t.querySelector(".accordion-content").appendChild(e),openAccordionByStep(t),injectCirclesAndListeners()}function createAccordionDOM(e,t,o=!1){const n=document.createElement("div");n.className="accordion-wrapper",e&&n.setAttribute("data-step",String(e));const r=document.createElement("div");r.className="accordion-header",r.innerHTML=`\n      <span class="step-title">Step ${e}: ${t}</span>\n      <span class="accordion-icon">\n        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n          <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />\n        </svg>\n      </span>`;const c=document.createElement("div");c.className="accordion-content-wrapper";const i=document.createElement("div");return i.className="accordion-content",i.style.maxHeight=o?5===e?"375px":i.scrollHeight+"px":"0px",o&&i.classList.add("open"),o&&r.querySelector("svg")&&(r.querySelector("svg").style.transform="rotate(180deg)"),c.appendChild(i),n.appendChild(r),n.appendChild(c),n}function openAccordionByStep(e){const t="number"==typeof e?document.querySelector(`.accordion-wrapper[data-step="${e}"]`):e;if(!t)return;const o=t.querySelector(".accordion-content");if(!o)return;o.classList.add("open"),t.classList.add("accordion-open");if(5===(Number(t.getAttribute("data-step"))||null))o.style.maxHeight="375px";else{const e=o.scrollHeight||2e3;o.style.maxHeight=e+"px"}const n=t.querySelector(".accordion-header svg");n&&(n.style.transform="rotate(180deg)"),setTimeout(()=>{o.classList.contains("open")&&(o.style.maxHeight=(o.scrollHeight||2e3)+"px")},250),o.querySelectorAll("img").forEach(e=>{e.complete||e.addEventListener("load",()=>{o.classList.contains("open")&&(o.style.maxHeight=(o.scrollHeight||2e3)+"px")})})}function attachAccordionDelegation(){window.__accordionDelegationAttached||(document.body.addEventListener("click",e=>{const t=e.target.closest&&e.target.closest(".accordion-header");if(!t)return;const o=t.closest(".accordion-wrapper");if(!o)return;const n=o.querySelector(".accordion-content");if(!n)return;const r=n.classList.toggle("open");o.classList.toggle("accordion-open",r);const c=Number(o.getAttribute("data-step"))||null;n.style.maxHeight=r&&5===c?"375px":r?n.scrollHeight+"px":"0px";const i=t.querySelector("svg");i&&(i.style.transform=r?"rotate(180deg)":"rotate(0deg)")}),window.__accordionDelegationAttached=!0)}function moveVariantPicker(){const e=document.querySelector(".custom-sign-wrapper"),t=document.querySelector(".avp-option.ap-options__swatch-container");if(e&&t){const o=t.parentNode,n=t.nextSibling;for(;e.firstChild;)o.insertBefore(e.firstChild,n);e.parentNode&&e.parentNode.removeChild(e)}}function moveProductPriceAboveQty(){try{const e=document.getElementById("product-price");if(!e)return;const t=document.querySelector(".qty-selector");if(!t||!t.parentNode||!t.parentNode.parentNode)return;const o=t.parentNode;if(o.previousSibling===e)return;o.parentNode.insertBefore(e,o)}catch(e){}}function insertSteps4And5IntoApp(){const e=document.querySelector(".avpoptions-container__v2");if(!e)return;let t=e.querySelector(".custom-sign-wrapper")||null;const o=(t,o)=>e.querySelector(`.accordion-wrapper[data-step="${t}"]`)?null:createAccordionDOM(t,o,!1),n=o(4,"Choose Orientation");if(n){t&&t.parentNode?t.parentNode.insertBefore(n,t.nextSibling):e.appendChild(n);const o=document.querySelector(".avp-option.ap-options__select-container")||document.querySelector(".ap-options__select-container");o&&!o.closest(".accordion-wrapper")&&n.querySelector(".accordion-content").appendChild(o),t=n}const r=o(5,"Add Text Messages And any other comments");r&&(t&&t.parentNode?t.parentNode.insertBefore(r,t.nextSibling):e.appendChild(r),document.querySelectorAll(".ap-options__textarea-container, .ap-options__file-container").forEach(e=>{e&&!e.closest(".accordion-wrapper")&&r.querySelector(".accordion-content").appendChild(e)}))}function injectCirclesAndListeners(){document.querySelectorAll(".avp-productoptionswatchwrapper").forEach(e=>{const t=e.querySelector('input[type="radio"]');if(t&&!e.querySelector(".custom-circle")){const o=document.createElement("span");o.className="custom-circle",e.insertBefore(o,t.nextSibling)}}),document.querySelectorAll('.avp-productoptionswatchwrapper input[type="radio"]').forEach(e=>{e.addEventListener("change",()=>{const t=e.name;document.querySelectorAll(`input[name="${t}"]`).forEach(e=>{const t=e.parentElement.querySelector(".custom-circle");t&&t.classList.remove("filled")});const o=e.parentElement.querySelector(".custom-circle");o&&o.classList.add("filled")}),e.checked&&e.dispatchEvent(new Event("change"))})}function setupAccordionStepAutoAdvance(){document.querySelectorAll('.accordion-wrapper input[type="radio"]').forEach(e=>{e.addEventListener("change",t=>{if(!t.isTrusted)return;if(!e.checked)return;const o=e.closest(".accordion-wrapper"),n=Number(o?.getAttribute("data-step")),r=isFinite(n)?n:e;isFinite(n)&&selectedSteps.add(n),goToNextAccordionStep(r)})}),document.querySelectorAll(".accordion-wrapper select").forEach(e=>{e.addEventListener("change",t=>{if(!t.isTrusted)return;const o=e.closest(".accordion-wrapper"),n=Number(o?.getAttribute("data-step"));isFinite(n)?goToNextAccordionStep(n):goToNextAccordionStep(e)})})}function goToNextAccordionStep(e){console.log("goToNextAccordionStep called with:",e);let t=null;if("number"==typeof e)t=e;else if(e&&e.closest){const o=e.closest(".accordion-wrapper");t=Number(o?.getAttribute("data-step"))}if(!isFinite(t))return;const o=document.querySelector(".avpoptions-container__v2")||document.body,n=o.querySelector(`.accordion-wrapper[data-step="${t}"]`);if(n){const e=n.querySelector(".accordion-content"),t=n.querySelector(".accordion-icon svg");e&&(e.classList.remove("open"),e.style.maxHeight="0px"),t&&(t.style.transform="rotate(0deg)")}if(1===t){const e=document.getElementById("product-price");e&&e.classList&&e.classList.remove("hidden")}let r=o.querySelector(`.accordion-wrapper[data-step="${t+1}"]`);if(!r){const e=Array.from(o.querySelectorAll(".accordion-wrapper[data-step]")).map(e=>({el:e,step:Number(e.getAttribute("data-step"))})).filter(e=>isFinite(e.step)&&e.step>t).sort((e,t)=>e.step-t.step);e.length&&(r=e[0].el)}if(!r){const e=Array.from(o.querySelectorAll(".accordion-wrapper")),t=e.indexOf(n);t>=0&&t+1<e.length&&(r=e[t+1])}if(r){const e=r.querySelector(".accordion-content"),t=r.querySelector(".accordion-icon svg");if(e){e.classList.add("open");const t=Number(r.getAttribute("data-step"))||null;e.style.maxHeight=5===t?"375px":(e.scrollHeight||2e3)+"px"}t&&(t.style.transform="rotate(180deg)")}}function updateSizeOptions(){const e=document.querySelector('select[name="Choose Material"]');let t="";if(e&&(t=(e.options[e.selectedIndex]?.text||"").trim()),!t){const e=document.querySelector('input[name="Choose Material"]:checked');e&&(t=(e.value||"").trim())}if(!t){const e=document.querySelector('variant-button[data-option-name="Choose Material"] .m-product-option--node input:checked');e&&(t=(e.getAttribute("data-value")||e.value||"").trim())}if(!t)return;const o=window.meta?.product?.variants||[],n=[],r=new Set;o.forEach(e=>{let o="",c="";if(e.options&&e.options.length>=2)o=String(e.options[0]).trim(),c=String(e.options[1]).trim();else if(e.option1||e.option2)o=(e.option1||"").trim(),c=(e.option2||"").trim();else if(e.public_title&&e.public_title.includes(" / ")){const t=e.public_title.split(" / ").map(e=>e.trim());o=t[0]||"",c=t[1]||""}o&&c&&o.toLowerCase()===t.toLowerCase()&&(r.has(c)||(r.add(c),n.push({size:c,id:String(e.id)})))}),document.querySelectorAll('select[name="Choose Size"]').forEach(e=>{const t=e.value;if(e.innerHTML="",n.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.size,e.appendChild(o)}),1===n.length){e.value=n[0].id;const t=document.getElementById("custom-sign-selected-variant");t&&(t.value=n[0].id,t.dispatchEvent(new Event("change",{bubbles:!0})))}else if(t){if(Array.from(e.options).find(e=>e.value===t))e.value=t;else if(n.length>0){e.value=n[0].id;const t=document.getElementById("custom-sign-selected-variant");t&&(t.value=n[0].id,t.dispatchEvent(new Event("change",{bubbles:!0})))}}e.dispatchEvent(new Event("change",{bubbles:!0}))}),document.querySelectorAll('div.m-product-option--node[data-option-position="2"]').forEach(e=>{const t=e.querySelector("input"),o=(e.getAttribute("data-value")||t?.value||"").trim();if(!o)return;n.some(e=>e.size===o||e.id===o)?(e.classList.remove("m-product-option--node__unavailable"),t&&t.removeAttribute("disabled")):(e.classList.add("m-product-option--node__unavailable"),t&&t.setAttribute("disabled","disabled"))})}function updateProductGalleryWithSwatchImages(){try{const e=document.querySelector(".ap-options__swatch-container");if(!e)return;const t=Array.from(e.querySelectorAll("[data-src]"));if(!t.length)return;const o=document.querySelector("#product-glide .glide__slides"),n=document.querySelector("#product-thumbs .glide__slides");if(!o)return;const r=o.querySelector("li img")&&o.querySelector("li img").src||null,c=[];if(r&&c.push(r),t.forEach(e=>{const t=e.getAttribute("data-src")||"";t&&!c.includes(t)&&c.push(t)}),!c.length)return;o.innerHTML=c.map(e=>`<li class="glide__slide"><img src="${e}" alt="" class="w-full rounded shadow"></li>`).join(""),n&&(n.innerHTML=c.map((e,t)=>`<li class="glide__slide px-1 max-w-32"><button class="thumb-btn focus:outline-none" data-thumb-index="${t}"><img src="${e}" alt="" class="rounded"></button></li>`).join("")),document.dispatchEvent(new Event("product:content:replaced"));const i=document.getElementById("product-glide");t.forEach(e=>{const t=e.closest(".avp-productoptionswatchwrapper")||e,o=e.getAttribute("data-src");t.addEventListener("click",e=>{const t=c.indexOf(o);if(!(t<0))if(i&&i._glideInstance)try{i._glideInstance.go("="+t)}catch(e){}else i&&i.setAttribute("data-start-index",String(t))})}),e.querySelectorAll('input[type="radio"]').forEach(e=>{e.addEventListener("change",t=>{if(!e.checked)return;const o=e.closest(".avp-productoptionswatchwrapper"),n=o?o.querySelector("[data-src]")||o.querySelector("img"):null,r=n?n.getAttribute("data-src")||n.src:null,a=r?c.indexOf(r):-1;if(!(a<0))if(i&&i._glideInstance)try{i._glideInstance.go("="+a)}catch(t){}else i&&i.setAttribute("data-start-index",String(a))})})}catch(e){}}document.addEventListener("DOMContentLoaded",function(){if(document.querySelector(".avpoptions-container__v2"))onSwatchReady();else{new MutationObserver((e,t)=>{for(const o of e)for(const e of o.addedNodes)if(1===e.nodeType&&(e.classList.contains("avpoptions-container__v2")||e.querySelector(".avpoptions-container__v2")))return onSwatchReady(),void t.disconnect()}).observe(document.body,{childList:!0,subtree:!0})}});