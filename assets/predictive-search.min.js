class PredictiveSearch extends HTMLElement{constructor(){super(),console.log("PredictiveSearch constructor"),void 0===PredictiveSearch._nextId&&(PredictiveSearch._nextId=1),this._id=PredictiveSearch._nextId++,this.container=null,this.predictiveSearchResults=null,this.input=null,this._onInput=null,this._onFocus=null,this._toggleClickHandler=null,this._handleDocumentPointer=this._handleDocumentPointer.bind(this),this._scrollLockOwner=null,this._prevBodyOverflow=void 0,this._prevHtmlOverflow=void 0}connectedCallback(){if(!this._connected){this._connected=!0;try{console.debug&&console.debug(`[predictive-search #${this._id}] connected`)}catch(e){}if(this.input=this.querySelector('input[type="search"]')||this.querySelector('input[name="q"]')||this.querySelector("#Search"),this.predictiveSearchResults=this.querySelector("#predictive-search"),this.input&&this.predictiveSearchResults||(this._delegatedInit=e=>{try{const t=e.target;if(!t)return;if(t.matches&&(t.matches('input[type="search"]')||t.matches('input[name="q"]'))||"Search"===t.id||t.getAttribute&&"q"===t.getAttribute("name")){if(!this.input){this.input=t;try{console.debug&&console.debug(`[predictive-search #${this._id}] delegated bound input`)}catch(e){}this._onInput||(this._onInput=this.debounce(e=>this.onChange(e),300)),this.input.addEventListener("input",this._onInput),this._onFocus=e=>{},this.input.addEventListener("focus",this._onFocus)}if(!this.predictiveSearchResults){this.predictiveSearchResults=this.querySelector("#predictive-search");try{console.debug&&console.debug(`[predictive-search #${this._id}] delegated found results container`)}catch(e){}}this.input&&this.predictiveSearchResults&&(this.removeEventListener("input",this._delegatedInit),this.removeEventListener("focusin",this._delegatedInit))}}catch(e){}},this.addEventListener("input",this._delegatedInit),this.addEventListener("focusin",this._delegatedInit)),this.input){try{console.debug&&console.debug(`[predictive-search #${this._id}] wiring input handlers`)}catch(e){}this._onInput=this.debounce(e=>{this.onChange(e)},300),this.input.addEventListener("input",this._onInput),this._onFocus=e=>{},this.input.addEventListener("focus",this._onFocus)}try{let e=this.querySelector('button[type="submit"], [data-search-toggle], .search .search-toggle, span > svg, .search span');if(e){try{e.tagName&&"svg"===e.tagName.toLowerCase()&&(e=e.closest("span")||e)}catch(e){}this._toggleClickHandler=e=>{e.preventDefault();try{this.input.focus(),this.input.value&&this.input.value.trim().length&&this.onChange()}catch(e){}},e.addEventListener("click",this._toggleClickHandler)}}catch(e){}document.addEventListener("pointerdown",this._handleDocumentPointer,!0)}}onChange(){const e=this.input.value.trim();try{console.debug&&console.debug(`[predictive-search #${this._id}] onChange: "${e}"`)}catch(e){}e.length?this.getSearchResults(e):this.close()}getSearchResults(e){try{console.debug&&console.debug(`[predictive-search #${this._id}] getSearchResults: "${e}"`)}catch(e){}const t=new URLSearchParams({q:e,section_id:"predictive-search","resources[limit]":"3","resources[type]":"product","resources[fields]":"title,product_type,variants.title,variants.sku"});fetch(`/search/suggest?${t.toString()}`).then(e=>{if(!e.ok){var t=new Error(e.status);throw this.close(),t}try{console.debug&&console.debug(`[predictive-search #${this._id}] suggest response ok`)}catch(e){}return e.text()}).then(t=>{const i=(new DOMParser).parseFromString(t,"text/html").querySelector("#shopify-section-predictive-search");if(i){this.predictiveSearchResults.innerHTML=i.innerHTML;try{console.debug&&console.debug(`[predictive-search #${this._id}] rendered results into container`)}catch(e){}this.container=this.predictiveSearchResults.querySelector("#predictive-search-results")||this.predictiveSearchResults,this.open();try{window.applyHoverImages&&window.applyHoverImages()}catch(e){}try{var s=t.match(/(\d[\d,\.]*)\s+results?/i),r=this.predictiveSearchResults.querySelector(".view-all-results");if(s&&s[1]){var c=s[1].replace(/[,\.]/g,""),n=this.predictiveSearchResults.querySelector("#res-qty");n&&(n.innerHTML="&nbsp;"+c+"&nbsp;")}else if(r){var h=encodeURIComponent(e);fetch(`/search?q=${h}`,{credentials:"same-origin"}).then(e=>e.text()).then(e=>{try{var t=e.match(/(\d[\d,\.]*)\s+results?/i);if(t&&t[1]){var i=t[1].replace(/[,\.]/g,""),s=this.predictiveSearchResults.querySelector("#res-qty");s&&(s.innerHTML="&nbsp;"+i+"&nbsp;")}}catch(e){}}).catch(()=>{})}}catch(e){}}}).catch(e=>{throw this.close(),e})}_handleDocumentPointer(e){try{var t=this.container||this.predictiveSearchResults&&this.predictiveSearchResults.querySelector("#predictive-search-results")||this.predictiveSearchResults,i=this.input||this.querySelector('input[type="search"]')||this.querySelector("#Search"),s=!1;try{t&&t.contains&&t.contains(e.target)&&(s=!0)}catch(e){}var r=!1;try{(i===e.target||i&&i.contains&&i.contains(e.target))&&(r=!0)}catch(e){}s||r||this.close()}catch(e){}}disconnectedCallback(){try{document.removeEventListener("pointerdown",this._handleDocumentPointer,!0)}catch(e){}try{this.input&&(this._onInput&&this.input.removeEventListener("input",this._onInput),this._onFocus&&this.input.removeEventListener("focus",this._onFocus))}catch(e){}try{let e=this.querySelector('button[type="submit"], [data-search-toggle], .search .search-toggle, span > svg, .search span');if(e&&this._toggleClickHandler){try{e.tagName&&"svg"===e.tagName.toLowerCase()&&(e=e.closest("span")||e)}catch(e){}e.removeEventListener("click",this._toggleClickHandler)}}catch(e){}try{this._delegatedInit&&(this.removeEventListener("input",this._delegatedInit),this.removeEventListener("focusin",this._delegatedInit),this._delegatedInit=null)}catch(e){}}open(){var e=this.container||this.predictiveSearchResults;try{e&&(e.style.display="block")}catch(e){}}close(){var e=this.container||this.predictiveSearchResults;try{e&&(e.style.display="none")}catch(e){}}debounce(e,t){let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>e.apply(this,s),t)}}}customElements.define("predictive-search",PredictiveSearch);