class PredictiveSearch extends HTMLElement{constructor(){super(),this.container=null,this.mobileOverlay=null,this.mobileInput=null,this.mobileResults=null,this.predictiveSearchResults=null,this.input=null,this._mobileOpen=!1,this._onInput=null,this._onFocus=null,this._toggleClickHandler=null,this._onMobileInput=null,this._handleDocumentPointer=this._handleDocumentPointer.bind(this),this._scrollLockOwner=null,this._prevBodyOverflow=void 0,this._prevHtmlOverflow=void 0}connectedCallback(){if(!this._connected&&(this._connected=!0,this.input=this.querySelector('input[type="search"]')||this.querySelector("#Search")||document.getElementById("Search"),this.predictiveSearchResults=this.querySelector("#predictive-search")||document.getElementById("predictive-search"),this.input&&this.predictiveSearchResults)){this._onInput=this.debounce(e=>{this.onChange(e)},300),this.input.addEventListener("input",this._onInput),this._onFocus=e=>{try{window.matchMedia&&window.matchMedia("(max-width: 767px)").matches&&this.openMobileOverlay()}catch(e){}},this.input.addEventListener("focus",this._onFocus);try{let e=this.querySelector('button[type="submit"], [data-search-toggle], .search .search-toggle, span > svg, .search span');if(e){try{e.tagName&&"svg"===e.tagName.toLowerCase()&&(e=e.closest("span")||e)}catch(e){}this._toggleClickHandler=e=>{e.preventDefault();try{this.input.focus(),this.input.value&&this.input.value.trim().length&&this.onChange()}catch(e){}},e.addEventListener("click",this._toggleClickHandler)}}catch(e){}this._bindMobileInputs(),document.addEventListener("pointerdown",this._handleDocumentPointer,!0)}}onChange(){const e=this.input.value.trim();e.length?this.getSearchResults(e):this.close()}getSearchResults(e){const t=new URLSearchParams({q:e,section_id:"predictive-search","resources[limit]":"9","resources[type]":"product","resources[fields]":"title,product_type,variants.title,variants.sku"});fetch(`/search/suggest?${t.toString()}`).then(e=>{if(!e.ok){var t=new Error(e.status);throw this.close(),t}return console.log(e),e.text()}).then(t=>{const i=(new DOMParser).parseFromString(t,"text/html").querySelector("#shopify-section-predictive-search");if(i){this._mobileOpen?(this.mobileResults=document.getElementById("predictive-search-mobile-results"),this.mobileResults?(this.mobileResults.innerHTML=i.innerHTML,this.container=this.mobileResults):(this.predictiveSearchResults.innerHTML=i.innerHTML,this.container=this.predictiveSearchResults.querySelector("#predictive-search-results")||this.predictiveSearchResults)):(this.predictiveSearchResults.innerHTML=i.innerHTML,this.container=this.predictiveSearchResults.querySelector("#predictive-search-results")||this.predictiveSearchResults),this.open();try{window.applyHoverImages&&window.applyHoverImages()}catch(e){}try{var s=t.match(/(\d[\d,\.]*)\s+results?/i),r=this.predictiveSearchResults.querySelector(".view-all-results");if(s&&s[1]){var o=s[1].replace(/[,\.]/g,""),l=this.predictiveSearchResults.querySelector("#res-qty");l&&(l.innerHTML="&nbsp;"+o+"&nbsp;")}else if(r){var n=encodeURIComponent(e);fetch(`/search?q=${n}`,{credentials:"same-origin"}).then(e=>e.text()).then(e=>{try{var t=e.match(/(\d[\d,\.]*)\s+results?/i);if(t&&t[1]){var i=t[1].replace(/[,\.]/g,""),s=this.predictiveSearchResults.querySelector("#res-qty");s&&(s.innerHTML="&nbsp;"+i+"&nbsp;")}}catch(e){}}).catch(()=>{})}}catch(e){}}}).catch(e=>{throw this.close(),e})}_handleDocumentPointer(e){try{var t=this.container||document.getElementById("predictive-search-results")||this.predictiveSearchResults,i=document.getElementById("Search")||this.input,s=!1;try{t&&t.contains&&t.contains(e.target)&&(s=!0)}catch(e){}var r=!1;try{(i===e.target||i&&i.contains&&i.contains(e.target))&&(r=!0)}catch(e){}s||r||this.close()}catch(e){}}_bindMobileInputs(){try{this.mobileOverlay=document.getElementById("predictive-search-mobile"),this.mobileInput=document.getElementById("SearchMobile"),this.mobileResults=document.getElementById("predictive-search-mobile-results");var e=document.getElementById("predictive-search-mobile-close");this.mobileInput&&(this._onMobileInput=this.debounce(e=>{try{this.input.value=e.target.value}catch(e){}this.onChange()},300),this.mobileInput.addEventListener("input",this._onMobileInput),this.mobileInput.addEventListener("keydown",e=>{})),e&&e.addEventListener("click",e=>{e.preventDefault(),this.closeMobileOverlay()})}catch(e){}}openMobileOverlay(){try{this._mobileOpen=!0,this.mobileOverlay=document.getElementById("predictive-search-mobile"),this.mobileResults=document.getElementById("predictive-search-mobile-results"),this.mobileOverlay&&(this.mobileOverlay.classList.remove("hidden"),this.mobileOverlay.setAttribute("aria-hidden","false")),this.mobileInput&&this.mobileInput.focus(),this.mobileResults&&(this.container=this.mobileResults);try{this._prevBodyOverflow=document.body.style.overflow||"",document.body.style.overflow="hidden",this._prevHtmlOverflow=document.documentElement.style.overflow||"",document.documentElement.style.overflow="hidden",this._scrollLockOwner="mobile"}catch(e){}}catch(e){}}closeMobileOverlay(){try{this._mobileOpen=!1,this.mobileOverlay&&(this.mobileOverlay.classList.add("hidden"),this.mobileOverlay.setAttribute("aria-hidden","true")),this.container=this.predictiveSearchResults.querySelector("#predictive-search-results")||this.predictiveSearchResults,this.close();try{void 0!==this._prevBodyOverflow&&(document.body.style.overflow=this._prevBodyOverflow),void 0!==this._prevHtmlOverflow&&(document.documentElement.style.overflow=this._prevHtmlOverflow),this._scrollLockOwner=null,this._prevBodyOverflow=void 0,this._prevHtmlOverflow=void 0}catch(e){}}catch(e){}}disconnectedCallback(){try{document.removeEventListener("pointerdown",this._handleDocumentPointer,!0)}catch(e){}try{this.input&&(this._onInput&&this.input.removeEventListener("input",this._onInput),this._onFocus&&this.input.removeEventListener("focus",this._onFocus))}catch(e){}try{let e=this.querySelector('button[type="submit"], [data-search-toggle], .search .search-toggle, span > svg, .search span');if(e&&this._toggleClickHandler){try{e.tagName&&"svg"===e.tagName.toLowerCase()&&(e=e.closest("span")||e)}catch(e){}e.removeEventListener("click",this._toggleClickHandler)}}catch(e){}try{this.mobileInput&&this._onMobileInput&&this.mobileInput.removeEventListener("input",this._onMobileInput)}catch(e){}}open(){(this.container||this.predictiveSearchResults).style.display="block";try{this._mobileOpen||"mobile"===this._scrollLockOwner||this._scrollLockOwner||(this._scrollLockOwner="desktop",this._prevBodyOverflow=document.body.style.overflow||"",document.body.style.overflow="hidden",this._prevHtmlOverflow=document.documentElement.style.overflow||"",document.documentElement.style.overflow="hidden")}catch(e){}}close(){(this.container||this.predictiveSearchResults).style.display="none";try{"desktop"===this._scrollLockOwner&&(void 0!==this._prevBodyOverflow&&(document.body.style.overflow=this._prevBodyOverflow),void 0!==this._prevHtmlOverflow&&(document.documentElement.style.overflow=this._prevHtmlOverflow),this._scrollLockOwner=null,this._prevBodyOverflow=void 0,this._prevHtmlOverflow=void 0)}catch(e){}}debounce(e,t){let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>e.apply(this,s),t)}}}customElements.define("predictive-search",PredictiveSearch);