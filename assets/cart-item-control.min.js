class CartQtyControl extends HTMLElement{constructor(){super(),this.plusButton=this.querySelector("[data-plus]"),this.minusButton=this.querySelector("[data-minus]"),this.removeBtn=this.querySelector("[data-remove]"),this.isAddon=this.dataset.isAddon||!1}connectedCallback(){this.plusButton.addEventListener("click",this.handleClick.bind(this)),this.minusButton.addEventListener("click",this.handleClick.bind(this)),this.removeBtn&&this.removeBtn.addEventListener("click",this.handleClick.bind(this))}handleClick(t){let e=null,s=this.dataset.key;if(this.isAddon){const t=document.querySelector(`[data-addon-parent_key="${s}"]`);t&&(e=t.getAttribute("data-addon-line-key"))}let n={[s]:0|t.target.dataset.quantity};e&&(n[e]=t.target.dataset.quantity);const i={updates:n,sections:"esaftey-cart-drawer,cart-count"};this.setLoading(!0),console.log("Sending cart update:",i),fetch(window.Shopify.routes.root+"cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(t=>(console.log("Response received:",t),t.json())).then(t=>{if(console.log("Item quantity updated:",t),window.location&&window.location.pathname&&window.location.pathname.startsWith("/cart"))try{return void window.location.reload()}catch(t){}document.documentElement.dispatchEvent(new CustomEvent("cart:render",{detail:t,bubbles:!0})),this.setLoading(!1)}).catch(t=>{console.error("Error:",t)})}disconnectedCallback(){this.removeEventListener("click",this.onClick),this.removeBtn&&this.removeBtn.removeEventListener("click",this.removeItemLine.bind(this))}setLoading(t){const e=this.querySelector(".qty-loading"),s=this.querySelectorAll("button");e&&e.classList.toggle("hidden",!t),s.forEach(e=>e.disabled=t);const n=this.closest("table");if(n)n.classList.toggle("opacity-50",t),n.classList.toggle("pointer-events-none",t);else{const e=this.closest("tr")||this.closest("div");e&&e.classList.toggle("opacity-50",t)}}}customElements.define("cart-qty-control",CartQtyControl);