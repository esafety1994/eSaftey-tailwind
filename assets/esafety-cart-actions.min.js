if(!customElements.get("esafety-cart-action-button")){class t extends HTMLElement{constructor(){super()}connectedCallback(){this.addEventListener("submit",this.handleSubmit.bind(this))}handleSubmit(t){t.preventDefault();const e=document.querySelector(".m-product-custom-field");if(e){e.querySelectorAll(".custom-field-error").forEach(t=>t.remove()),e.querySelectorAll(".field-error").forEach(t=>t.classList.remove("field-error"));const t=e.querySelectorAll(".form-field ");if(t&&0!==t.length)for(const n of t){const t=n.hasAttribute&&n.hasAttribute("required");if(console.log(".custom_field required:",t),!t)continue;let s=null;try{if(n.matches&&n.matches("input,textarea,select"))s=n;else if(s=n.querySelector("input,textarea,select"),s||(s=n.querySelector(".form-field")),!s){let t=n.nextElementSibling;for(;t&&(!t.classList||!t.classList.contains("form-field"));)t=t.nextElementSibling;s=t}}catch(t){s=null}let i=!0;if(s){const t=s.tagName&&s.tagName.toLowerCase();if("input"===t){const t=(s.type||"").toLowerCase();if("checkbox"===t)i=!s.checked;else if("radio"===t)if(s.name){i=!e.querySelector(`input[name="${s.name}"]:checked`)}else i=!s.checked;else i=!(s.value&&s.value.toString().trim())}else i="textarea"===t||"select"===t?!(s.value&&s.value.toString().trim()):!(s.textContent||"").toString().trim()}else i=!0;if(i){n.querySelectorAll&&n.querySelectorAll(".custom-field-error").forEach(t=>t.remove());const t=document.createElement("div");t.className="custom-field-error bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-sm",t.style.color="red";let i="";const r=s&&s.id;if(r){const t=e.querySelector(`label[for="${r}"]`);if(t){const e=t.cloneNode(!0);e.querySelectorAll&&e.querySelectorAll("sup").forEach(t=>t.remove()),i=(e.textContent||"").trim()}}if(!i){const t=n.previousElementSibling&&n.previousElementSibling.tagName&&"label"===n.previousElementSibling.tagName.toLowerCase()?n.previousElementSibling:null;if(t){const e=t.cloneNode(!0);e.querySelectorAll&&e.querySelectorAll("sup").forEach(t=>t.remove()),i=(e.textContent||"").trim()}}t.textContent=i?`${i} is required`:"This field is required",s&&s.classList?s.classList.add("field-error"):n.classList&&n.classList.add("field-error"),s&&s.insertAdjacentElement?s.insertAdjacentElement("afterend",t):n.insertAdjacentElement&&n.insertAdjacentElement("afterend",t);try{(s||n).focus()}catch(t){}return}}else console.log("No .custom_field elements found inside .m-product-custom-field")}else console.log("No .m-product-custom-field container found");let n={};if(e){const t=e.querySelectorAll("label"),s=Array.from(t).map(t=>{let e=null;const n=t.getAttribute&&t.getAttribute("for");if(n&&(e=document.getElementById(n)),!e){let n=t.nextElementSibling;for(;n&&(!n.classList||!n.classList.contains("form-field"));)n=n.nextElementSibling;e=n}let s="";if(e){const t=e.tagName&&e.tagName.toLowerCase();s="input"===t||"textarea"===t||"select"===t?e.value||"":(e.textContent||"").trim()}const i=t.cloneNode(!0);i.querySelectorAll&&i.querySelectorAll("sup").forEach(t=>t.remove());return{label:(i.textContent||"").trim(),value:s}});e.fieldPairs=s,s.forEach(t=>{n[t.label]=t.value||!0})}try{const e=t.target&&t.target.closest&&t.target.closest("form")||document.querySelector("#product-act-button form")||document.querySelector('form[action*="/cart/add"]'),s={};e&&(e.querySelectorAll("select[name]").forEach(t=>{const e=t.name&&t.name.trim();if(!e)return;const n=t.options&&t.options[t.selectedIndex],i=n?(n.textContent||n.value||"").trim():(t.value||"").trim();i&&(s[e]=i)}),e.querySelectorAll('input[type="radio"][name]').forEach(t=>{if(!t.checked)return;const e=t.name&&t.name.trim();if(!e)return;let n=(t.value||"").trim();const i=t.closest&&t.closest(".avp-productoptionswatchwrapper");if(i){const t=(i.textContent||"").trim();t&&(n=t)}else{const e=t.id;if(e){const t=document.querySelector('label[for="'+e+'"]');t&&(t.textContent||"").trim()&&(n=t.textContent.trim())}}n&&(s[e]=n)}),e.querySelectorAll('input[type="text"][name], textarea[name]').forEach(t=>{const e=t.name&&t.name.trim();if(!e)return;const n=(t.value||"").trim();n&&(s[e]=n)}));const i=document.querySelector(".ap-options__swatch-container");i&&i.querySelectorAll('input[type="radio"][name]').forEach(t=>{if(!t.checked)return;const e=t.name&&t.name.trim();if(!e)return;const n=t.closest&&t.closest(".avp-productoptionswatchwrapper");let i="";n&&(i=(n.textContent||"").trim()),i||(i=(t.value||"").trim()),i&&(s[e]=i)}),0===Object.keys(n).length&&Object.keys(s).length>0?n=s:Object.keys(s).forEach(t=>{n[t]||(n[t]=s[t])})}catch(t){}const s=t.target&&t.target.closest&&t.target.closest("form")||this.querySelector("form");if(!s)return;const i=s.querySelector("button.primary-cart-button"),r=t=>{i&&(t?(i.disabled=!0,i.setAttribute("aria-busy","true"),i.classList.add("opacity-50","pointer-events-none")):(i.disabled=!1,i.removeAttribute("aria-busy"),i.classList.remove("opacity-50","pointer-events-none")))};r(!0);var o=s.querySelector('input[name="quantity"]'),a=1;try{o&&o.value&&(a=parseInt(o.value,10)||1)}catch(t){a=1}var c=s.querySelector('input[name="id"]');const l={items:[{id:c&&c.value?c.value:null,quantity:a,properties:n}],sections:"esaftey-cart-drawer,cart-count"};console.log("Adding to cart",l),fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(t=>t.json()).then(t=>{document.documentElement.dispatchEvent(new CustomEvent("cart:render",{detail:t,bubbles:!0})),r(!1)}).catch(t=>{console.error("Add to cart failed",t),r(!1)})}disconnectedCallback(){}}customElements.define("esafety-cart-action-button",t)}class EsafetyCartActionsAddToCartButton extends HTMLElement{constructor(){super()}connectedCallback(){this.addBtn=this.querySelector("[data-button-type='add-to-cart']"),this._onAdd=this.handleAdd.bind(this),this.addBtn.addEventListener("click",this._onAdd);try{const t=this.querySelector("[data-qty-input-counter]");t&&(this._counter=t,this._qtyInput=t.querySelector('input[name="qty"]'),this._minusBtn=t.querySelector("button:first-of-type"),this._plusBtn=t.querySelector("button:last-of-type"),this._qtyInput&&(this._onQtyChange=this.onQtyInputChange.bind(this),this._qtyInput.addEventListener("change",this._onQtyChange),this._qtyInput.addEventListener("blur",this._onQtyChange)),this._onCounterClick=this.onCounterClick.bind(this),this._counter.addEventListener("click",this._onCounterClick))}catch(t){}}setLoading(t){try{const e=document.getElementById("global-spinner-overlay");if(t){if(this._isLoading)return;this._isLoading=!0,this.addBtn&&(this.addBtn.disabled=!0,this.addBtn.classList.add("opacity-50","pointer-events-none")),this._counter&&this._counter.classList.add("opacity-50","pointer-events-none"),e&&e.classList.remove("hidden")}else this._isLoading=!1,this.addBtn&&(this.addBtn.disabled=!1,this.addBtn.classList.remove("opacity-50","pointer-events-none")),this._counter&&this._counter.classList.remove("opacity-50","pointer-events-none"),e&&e.classList.add("hidden")}catch(t){}}disconnectedCallback(){try{this.addBtn&&this._onAdd&&this.addBtn.removeEventListener("click",this._onAdd),this._counter&&this._onCounterClick&&this._counter.removeEventListener("click",this._onCounterClick),this._qtyInput&&this._onQtyChange&&(this._qtyInput.removeEventListener("change",this._onQtyChange),this._qtyInput.removeEventListener("blur",this._onQtyChange))}catch(t){}}handleAdd(t){if(t.preventDefault(),this._isLoading)return;const e=this.querySelector("[data-qty-input-counter] .custom-number-input");e.classList.remove("right-1/2","opacity-0"),e.classList.add("-right-1/2","opacity-100"),this.addBtn.classList.add("opacity-0"),this.addBtn.classList.remove("opacity-100"),this._qtyInput&&(this._qtyInput.value=1);const n=this.getVariantId();n&&this.addToCart(n,1);this.closest("esafety-cart-action-button")}handleMinus(t){if(t.preventDefault(),!this._isLoading&&this._qtyInput)try{let t=parseInt(this._qtyInput.value,10)||0;t=Math.max(0,t-1),this._qtyInput.value=t;const e=this.querySelector("[data-qty-input-counter] .custom-number-input");if(e&&0===t){const t=parseProductId(this.getAttribute("data-product"));return t&&this.addToCart(t,0),this._qtyInput.value=1,e.classList.remove("right-1/2","opacity-100"),e.classList.add("-right-1/2","opacity-0"),this.addBtn.classList.add("opacity-100"),void this.addBtn.classList.remove("opacity-0")}const n=this.getVariantId();n&&t>0&&this.addToCart(n,t)}catch(t){}}handlePlus(t){if(t.preventDefault(),!this._isLoading&&this._qtyInput)try{let t=parseInt(this._qtyInput.value,10)||0;t+=1,this._qtyInput.value=t;const e=this.querySelector("[data-qty-input-counter] .custom-number-input");e&&(e.classList.remove("right-1/2"),e.classList.add("-right-1/2"));const n=this.getVariantId();n&&t>0&&this.addToCart(n,t)}catch(t){}}getVariantId(){try{const t=this.closest("esafety-cart-action-button");if(t){const e=t.querySelector('input[name="id"]').cloneNode?t.querySelector('input[name="id"]'):null;if(e&&e.value)return e.value}const e=this.querySelector&&this.querySelector('input[name="id"]');if(e&&e.value)return e.value;const n=this.getAttribute("data-product");return parseProductId(n)}catch(t){return null}}onCounterClick(t){try{const e=t.target&&t.target.closest&&t.target.closest("button");if(!e)return;e===this._plusBtn?this.handlePlus(t):e===this._minusBtn&&this.handleMinus(t)}catch(t){}}onQtyInputChange(t){if(this._qtyInput&&!this._isLoading)try{const t=parseInt(this._qtyInput.value,10)||0,e=this.getVariantId();if(!e)return;if(t>0)this.addToCart(e,t);else{this.addToCart(e,0);const t=this.querySelector("[data-qty-input-counter] .custom-number-input");t&&(t.classList.remove("right-1/2","opacity-100"),t.classList.add("-right-1/2","opacity-0")),this.addBtn.classList.remove("opacity-0"),this.addBtn.classList.add("opacity-100"),this._qtyInput.value=1}}catch(t){}}addToCart(t,e){console.log("Adding to cart",{productId:t,quantity:e});try{return this.setLoading&&this.setLoading(!0),fetch(window.Shopify.routes.root+"cart.js").then(t=>t.json()).then(n=>{const s=n&&n.items||[],i=s.find(e=>String(e.id)===String(t)),r=parseInt(e,10),o=isNaN(r)?1:r;if(i){const e=s.findIndex(e=>String(e.id)===String(t)),n=e>=0?e+1:null;if(console.log("Updating cart line",{productId:t,qty:o,match:i,line:n}),n)return fetch(window.Shopify.routes.root+"cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({line:n,quantity:o,sections:"esaftey-cart-drawer,cart-count"})}).then(t=>t.json());const r={};return r[i.key]=o,fetch(window.Shopify.routes.root+"cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:r,sections:"esaftey-cart-drawer,cart-count"})}).then(t=>t.json())}{const e={items:[{id:t,quantity:o}],sections:"esaftey-cart-drawer,cart-count"};return fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json())}}).then(t=>{try{document.documentElement.dispatchEvent(new CustomEvent("cart:render",{detail:t,bubbles:!0}))}catch(t){}this.setLoading&&this.setLoading(!1)}).catch(t=>{console.error("Cart operation failed",t),this.setLoading&&this.setLoading(!1)})}catch(t){this.setLoading&&this.setLoading(!1)}}}function parseProductId(t){if(!t)return null;if(/^\d+$/.test(t))return t;try{const e=JSON.parse(t);if(e&&e.id)return e.id;if(e&&e.variants&&e.variants[0]&&e.variants[0].id)return e.variants[0].id}catch(t){}return t}customElements.define("esafety-custom-add-to-cart-button",EsafetyCartActionsAddToCartButton);