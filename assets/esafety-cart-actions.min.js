if(!customElements.get("esafety-cart-action-button")){class e extends HTMLElement{constructor(){super()}connectedCallback(){this.addEventListener("submit",this.handleSubmit.bind(this))}handleSubmit(e){e.preventDefault();const t=document.querySelector(".m-product-custom-field");if(t){t.querySelectorAll(".custom-field-error").forEach(e=>e.remove()),t.querySelectorAll(".field-error").forEach(e=>e.classList.remove("field-error"));const e=t.querySelectorAll(".form-field ");if(e&&0!==e.length)for(const r of e){const e=r.hasAttribute&&r.hasAttribute("required");if(console.log(".custom_field required:",e),!e)continue;let l=null;try{if(r.matches&&r.matches("input,textarea,select"))l=r;else if(l=r.querySelector("input,textarea,select"),l||(l=r.querySelector(".form-field")),!l){let e=r.nextElementSibling;for(;e&&(!e.classList||!e.classList.contains("form-field"));)e=e.nextElementSibling;l=e}}catch(e){l=null}let o=!0;if(l){const e=l.tagName&&l.tagName.toLowerCase();if("input"===e){const e=(l.type||"").toLowerCase();if("checkbox"===e)o=!l.checked;else if("radio"===e)if(l.name){o=!t.querySelector(`input[name="${l.name}"]:checked`)}else o=!l.checked;else o=!(l.value&&l.value.toString().trim())}else o="textarea"===e||"select"===e?!(l.value&&l.value.toString().trim()):!(l.textContent||"").toString().trim()}else o=!0;if(o){r.querySelectorAll&&r.querySelectorAll(".custom-field-error").forEach(e=>e.remove());const e=document.createElement("div");e.className="custom-field-error bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-sm",e.style.color="red";let o="";const n=l&&l.id;if(n){const e=t.querySelector(`label[for="${n}"]`);if(e){const t=e.cloneNode(!0);t.querySelectorAll&&t.querySelectorAll("sup").forEach(e=>e.remove()),o=(t.textContent||"").trim()}}if(!o){const e=r.previousElementSibling&&r.previousElementSibling.tagName&&"label"===r.previousElementSibling.tagName.toLowerCase()?r.previousElementSibling:null;if(e){const t=e.cloneNode(!0);t.querySelectorAll&&t.querySelectorAll("sup").forEach(e=>e.remove()),o=(t.textContent||"").trim()}}e.textContent=o?`${o} is required`:"This field is required",l&&l.classList?l.classList.add("field-error"):r.classList&&r.classList.add("field-error"),l&&l.insertAdjacentElement?l.insertAdjacentElement("afterend",e):r.insertAdjacentElement&&r.insertAdjacentElement("afterend",e);try{(l||r).focus()}catch(e){}return}}else console.log("No .custom_field elements found inside .m-product-custom-field")}else console.log("No .m-product-custom-field container found");let r={};if(t){const e=t.querySelectorAll("label"),l=Array.from(e).map(e=>{let t=null;const r=e.getAttribute&&e.getAttribute("for");if(r&&(t=document.getElementById(r)),!t){let r=e.nextElementSibling;for(;r&&(!r.classList||!r.classList.contains("form-field"));)r=r.nextElementSibling;t=r}let l="";if(t){const e=t.tagName&&t.tagName.toLowerCase();l="input"===e||"textarea"===e||"select"===e?t.value||"":(t.textContent||"").trim()}const o=e.cloneNode(!0);o.querySelectorAll&&o.querySelectorAll("sup").forEach(e=>e.remove());return{label:(o.textContent||"").trim(),value:l}});t.fieldPairs=l,l.forEach(e=>{r[e.label]=e.value||!0})}const l=e.target&&e.target.closest&&e.target.closest("form")||this.querySelector("form");if(!l)return;const o=l.querySelector("button.primary-cart-button"),n=o?o.innerHTML:null,i=o?o.style.width:null,s=e=>{if(o)if(e){try{const e=o.getBoundingClientRect();o.style.boxSizing="border-box",o.style.width=e.width+"px"}catch(e){}o.innerHTML='<svg class="animate-spin inline-block w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>',o.disabled=!0,o.setAttribute("aria-busy","true")}else o.innerHTML=n||"",o.style.width=i||"",o.disabled=!1,o.removeAttribute("aria-busy")};s(!0);const c={items:[{id:l.querySelector('input[name="id"]').value,quantity:l.querySelector('input[name="quantity"]').value,properties:r}],sections:"esaftey-cart-drawer,cart-count"};console.log("Adding to cart",c),fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then(e=>e.json()).then(e=>{document.documentElement.dispatchEvent(new CustomEvent("cart:render",{detail:e,bubbles:!0})),s(!1)}).catch(e=>{console.error("Add to cart failed",e),s(!1)})}disconnectedCallback(){}}customElements.define("esafety-cart-action-button",e)}